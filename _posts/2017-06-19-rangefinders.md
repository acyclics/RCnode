---
ID: 473
post_title: Rangefinders
author: impeccableaslan
post_date: 2017-06-19 04:41:05
post_excerpt: ""
layout: post
permalink: >
  http://rcnode.com/index.php/2017/06/19/rangefinders/
published: true
---
[et_pb_section fb_built="1" admin_label="section" _builder_version="3.0.47"][et_pb_row admin_label="row" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"][et_pb_column type="4_4" _builder_version="3.0.47" parallax="off" parallax_method="on"][et_pb_text admin_label="Text" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"]
					
				[/et_pb_text][et_pb_text _builder_version="3.0.51"]<h1>What does it do?</h1>
<p>Measures the distance from the observer to the target. Think of observer as the drone's rangefinder</p>
<h1></h1>
<h1>How do they work?</h1>
<p>They emit laser beams at the push of a button, those beams bounce off distant objects and the rangefinder's high-speed clock measures the time it took for the laser to return after it has left the unit. Since the speed of the beam is known due to the fact that it is the speed of light, the unit can simply measure time to calculate the distance it has <g class="gr_ gr_119 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="119" data-gr-id="119">travelled</g>.</p>
<h1></h1>
<h1></h1>
<h1>Types of connection</h1>
<p>Serial connection: The process of sending data one bit at a time, they are used for long distance communication. Computer buses is a communication system that transfers data between components inside a computer. Serial computer buses are useful even at <g class="gr_ gr_101 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="101" data-gr-id="101">short</g> distance as improved signal integrity and transmission speeds in newer serial technologies have begun to outweigh the parallel bus's advantage of simplicity (no need for serializer and deserializer, or SerDes) and to outstrip its disadvantages (clock skew, interconnect density).</p>
<p>Inter-integrated circuit: (I^2C): It is a protocol that allows multiple "slave" digital integrated <g class="gr_ gr_92 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="92" data-gr-id="92">circuit</g> (AKA chips, such as resistors) to communicate with one or more "master" chips. It is only intended for short distance communication within a single device. It communicates by using two signal wires to exchange information.</p>
<p>Serial peripheral interface (SPI): It is an interface bus commonly used to send data between microcontrollers and small peripherals (Able to be attached to a computer) such as sensors and SD cards. The purpose of it is to separate clock and data lines, along with a line to select which devices to talk to.</p>
<h1></h1>
<h1></h1>
<h1>Disadvantages of serial port</h1>
<p>Clock signal: In electronics, a clock signal is a particular type of signal that oscillates between a high and low state. It is used to coordinate actions of digital circuits. These signals are produced by clock generators and are <g class="gr_ gr_97 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="97" data-gr-id="97">time based</g>. Meaning the actions performed are based on time.</p>
<p>Asynchronous: Controlling the timing of operations by the use of pulses sent when the previous operation is completed rather than at regular intervals.</p>
<p>As serial ports are asynchronous (That is, no clock signal/data is transmitted), devices using them must agree ahead of time on a data rate (The signaling rate of which will be recognized). The two devices must have similar clocks that are close to the same rate. Big differences between the two clock rates will result in garbled data (Distorted, corrupted).</p>
<p>&nbsp;Overhead: In computers, overhead refers to the processing time required by system software, which includes the operating system and any utility that supports application programs</p>
<p>UART: Universal <g class="gr_ gr_91 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="91" data-gr-id="91">asynchronous</g> receiver/transmitter, is a microchip that controls the computer's interface to its attached serial devices. This is done so to exchange data with serial devices.</p>
<p>&nbsp;Asynchronous serial ports require hardware overhead as it needs to account for the time it takes for the hardware to process. The UART at either end is hard to implement. One start and <g class="gr_ gr_103 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="103" data-gr-id="103">stop</g> bit <g class="gr_ gr_104 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="104" data-gr-id="104">is</g> required when data is transmitted, therefore to transfer 8 bits of data, 10 bits are required. This eats into data rate (As <g class="gr_ gr_105 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="105" data-gr-id="105">less</g> data are able to be transmitted over time). Another feature of serial ports is that they are inherently suited for connection between two devices, and only the two. It is possible to connect multiple devices but bus contention (where two devices attempt to drive the same line at the same time) is always an issue. This is usually dealt with by external hardware.</p>
<h1></h1>
<h1></h1>
<h1>Disadvantages of SPI[caption width="600" id="attachment_477" align="<g class="gr_ gr_95 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="95" data-gr-id="95">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/SPI.png" width="600" height="346" alt="" class="wp-image-477 size-full" /> Image from https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi[/caption]</h1>
<p>The drawback of SPI is the number of pins required. Connecting a single master to a single slave with an SPI bus requires 4 lines. Each additional slave requires one additional chip to select I/O pin on the master. This amount of pins is undesirable in situations where lots of <g class="gr_ gr_112 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="112" data-gr-id="112">device</g> must <g class="gr_ gr_113 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="113" data-gr-id="113">be slaved</g> to one master. SPI allows only one master on the bus, but it does support an arbitrary number of slaves (<g class="gr_ gr_114 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="114" data-gr-id="114">Only</g> limit is the capacity of the devices and the number of chip select pins available)</p>
<p>Full-duplex: The transmission of data in two directions simultaneously</p>
<p>Shift register: It is a type of sequential logic circuit that can be used for storage or transfer of data in the form of binary numbers[caption width="370" id="attachment_478" align="<g class="gr_ gr_96 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="96" data-gr-id="96">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/parallel-data-input.png" width="370" height="237" alt="" class="wp-image-478 size-full" /> Image from https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi[/caption]</p>
<p>This sequential device loads the data present on its inputs and then moves or &ldquo;shifts&rdquo; it to its output once every clock cycle, hence the name Shift Register. Data bits may be fed in or out of a shift register serially, that is one after the other from either the left or the right direction, or all together at the same time in a parallel configuration. Shift Registers are used for data storage or for the movement of data and are therefore commonly used inside calculators or computers to store data such as two binary numbers before they are added together, or to convert the data from either a serial to parallel or parallel to serial format. These individual data are driven by a common clock signal so it's a synchronous device.</p>
<p>SPI is good for high data rate full-duplex (Simultaneous sending and receiving of data) connections, supporting clock rates up to 10 million bits per second for some devices and the speed scales nicely. The hardware at either end is usually a shift register, of which is easily implemented.</p>
<h1></h1>
<h1>I^2C[caption width="600" id="attachment_479" align="<g class="gr_ gr_84 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="84" data-gr-id="84">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/I2c.png" width="600" height="360" alt="" class="wp-image-479 size-full" /> Image from https://learn.sparkfun.com/tutorials/serial-peripheral-interface-spi[/caption]</h1>
<p>It requires into two wires, like the asynchronous serial but those two wires can support up to 1008 slave devices. Unlike SPI, it can support a multi-master system, allowing more than one master to communicate with all devices on the bus. These master devices can't talk to each other over the bus and must take turns using the bus line.</p>
<p><g class="gr_ gr_77 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="77" data-gr-id="77">Meta data</g>: A set of data that describes and gives information about other data</p>
<p>Data rates <g class="gr_ gr_89 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="89" data-gr-id="89">falls</g> between SPI and Serial. There is some overhead for every 8 bits as for every 8 bits of data sent, there's one extra bit of <g class="gr_ gr_78 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="78" data-gr-id="78">meta data</g> that must be transmitted.</p>
<p>Signals: Every I^2C bus consists of two signals: SCL and SDA. SCL is the clock signal and SDA is the data signal. This clock signal is always generated by the current bus master. Some slave devices may force the clock low at times to delay the master sending more data (or to require more time to prepare data before the master attempts to clock it out) - This is called clock stretching.</p>
<h1></h1>
<h1>Connecting to Pixhawk[caption width="713" id="attachment_491" align="<g class="gr_ gr_210 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="210" data-gr-id="210">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/rangefidner-con.png" width="713" height="220" alt="" class="wp-image-491 size-full" /> Image from ardupilot.org[/caption]</h1>
<p>Serial connection: For this connection, use any spare UART. Connect the RX line of the UART to the TX line of the Lidar, and the TX line of the UART to the RX line of the Lidar. <g class="gr_ gr_195 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="195" data-gr-id="195">Also</g> connect the GND and 5V lines. You do not need flow control pins.</p>
<p></p>
<p>This diagram shows how to connect to SERIAL 4:[caption width="888" id="attachment_492" align="<g class="gr_ gr_295 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="295" data-gr-id="295">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/serial-4.png" width="888" height="585" alt="" class="wp-image-492 size-full" /> Image from ardupilot.org[/caption]</p>
<p>You then need to setup the serial port and rangefinder parameters. If you have used the SERIAL4/5 port on the Pixhawk then you would set the following parameters (this is done in the Mission Planner Config/Tuning | Full Parameter List page):</p>
<p>-SERIAL4_PROTOCOL = 9 (Lidar)</p>
<p>-SERIAL4_BAUD = 19 (19200 baud)</p>
<p>-RNGFND_TYPE = 8 (LightWareSerial)</p>
<p>-RNGFND_SCALING = 1</p>
<p>-RNGFND_MIN_CM = 5</p>
<p>-RNGFND_MAX_CM = 2500 (for SF10A), 5000 (for SF10B), 10000 (for SF10C) or 12000 (for SF11C). This is the distance in centimeters that the rangefinder can reliably read. The value depends on the model of the lidar.</p>
<p>-RNGFND_GNDCLEAR = 10 or more accurately the distance in <g class="gr_ gr_263 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="263" data-gr-id="263">centimetres</g> from the range finder to the ground when the vehicle is landed. This value depends on how you have mounted the rangefinder.</p>
<p>&nbsp;</p>
<p>If you instead were using the Telem2 port on the Pixhawk then you would set SERIAL2_PROTOCOL = 9, and SERIAL2_BAUD = 19200</p>
<p>&nbsp;</p>
<p>I^2C connection: SHOULD NOT BE USED FOR COPTER. Connect the SDA line of the Lidar to the SDA line of the I2C port on the Pixhawk, and the SCL line of the Lidar to the SCL line of the I2C port. <g class="gr_ gr_260 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="260" data-gr-id="260">Also</g> connect the GND and 5V lines.[caption width="884" id="attachment_493" align="<g class="gr_ gr_365 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="365" data-gr-id="365">alignnone</g>"]<img src="http://rcnode.com/wp-content/uploads/2017/06/i2c-connection-pixhawk.png" width="884" height="585" alt="" class="wp-image-493 size-full" /> Image from ardupilot.org[/caption]</p>
<p>You then need to configure the rangefinder parameters as shown below (this is done in the Mission Planner Config/Tuning | Full Parameter List page):</p>
<p>-RNGFND_TYPE = 7 (LightWareI2C)</p>
<p>-RNGFND_ADDR = 102 (I2C Address of lidar in decimal). Please note that this setting is in decimal and not hexadecimal as shown in the lidar settings screen. The default address is 0x66 which is 102 in decimal.</p>
<p>-RNGFND_SCALING = 1</p>
<p>-RNGFND_MIN_CM = 5</p>
<p>-RNGFND_MAX_CM = 2500 (for SF10A), 5000 (for SF10B), 10000 (for SF10C) or 12000 (for SF11C). This is the distance in centimeters that the rangefinder can reliably read. The value depends on the model of the lidar.</p>
<p>-RNGFND_GNDCLEAR = 10 or more accurately the distance in <g class="gr_ gr_328 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="328" data-gr-id="328">centimetres</g> from the range finder to the ground when the vehicle is landed. This value depends on how you have mounted the rangefinder.</p>[/et_pb_text][et_pb_divider color="#000000" show_divider="on" divider_weight="2px" _builder_version="3.0.51"][/et_pb_divider][et_pb_comments _builder_version="3.0.51"][/et_pb_comments][/et_pb_column][/et_pb_row][/et_pb_section]