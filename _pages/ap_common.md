---
ID: 333
post_title: AP_Common
author: impeccableaslan
post_date: 2017-06-18 12:42:02
post_excerpt: ""
layout: page
permalink: http://rcnode.com/index.php/ap_common/
published: true
---
[et_pb_section fb_built="1" admin_label="section" _builder_version="3.0.47"][et_pb_row admin_label="row" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"][et_pb_column type="4_4" _builder_version="3.0.47" parallax="off" parallax_method="on"][et_pb_text admin_label="Text" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"]
					
				[/et_pb_text][et_pb_post_title meta="off" featured_image="off" _builder_version="3.0.51" text_orientation="center" title_font="Cantata One||||"][/et_pb_post_title][et_pb_tabs active_tab_background_color="#7cda24" _builder_version="3.0.51" tab_font="Cantata One||||"][et_pb_tab title="COMMON.h" _builder_version="3.0.51"]<p>This file houses the common definitions and utility routines for our drone library. Therefore, it <g class="gr_ gr_5 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="5" data-gr-id="5">contain</g> a number of objects that are used by different pieces of code in our library.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @file AP_Common.h</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @brief&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Common definitions and utility routines for the ArduPilot</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;libraries.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_HAL/AP_HAL_Boards.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;stdint.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;stdlib.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// used to pack structures</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">PACKED __attribute__</span><span style="color: #569cd6;" lang="en-US">((__packed__))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// used to mark a function that may be unused in some builds</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">UNUSED_FUNCTION __attribute__</span><span style="color: #569cd6;" lang="en-US">((unused))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// this can be used to optimize individual functions</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">OPTIMIZE</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">level</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">__attribute__</span><span style="color: #569cd6;" lang="en-US">((</span><span style="color: #989875;" lang="en-US">optimize</span><span style="color: #569cd6;" lang="en-US">(level)))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// sometimes we need to prevent inlining to prevent large stack usage</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">NOINLINE __attribute__</span><span style="color: #569cd6;" lang="en-US">((noinline))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">FMT_PRINTF</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">a,b</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">__attribute__</span><span style="color: #569cd6;" lang="en-US">((</span><span style="color: #989875;" lang="en-US">format</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">printf</span><span style="color: #569cd6;" lang="en-US">, a, b)))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">FMT_SCANF</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">a,b</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">__attribute__</span><span style="color: #569cd6;" lang="en-US">((</span><span style="color: #989875;" lang="en-US">format</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">scanf</span><span style="color: #569cd6;" lang="en-US">, a, b)))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">ToRad</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">x</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">radians</span><span style="color: #569cd6;" lang="en-US">(x)&nbsp;</span><span style="color: #608b4e;" lang="en-US">// *pi/180</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">ToDeg</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">x</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">degrees</span><span style="color: #569cd6;" lang="en-US">(x)&nbsp;</span><span style="color: #608b4e;" lang="en-US">// *180/pi</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Declare and implement const and non-const versions of the array subscript</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* operator. The object is treated as an array of type_ values. */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">DEFINE_BYTE_ARRAY_METHODS</span><span style="color: #569cd6;" lang="en-US"> \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">inline </span><span style="color: #47b7a0;" lang="en-US">uint8_t </span><span style="color: #979797;" lang="en-US">&amp;</span><span style="color: #c586c0;" lang="en-US">operator</span><span style="color: #989875;" lang="en-US">[]</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">size_t</span><span style="color: #569cd6;" lang="en-US"> i) { </span><span style="color: #c586c0;" lang="en-US">return</span><span style="color: #569cd6;" lang="en-US"> reinterpret_cast</span><span style="color: #979797;" lang="en-US">&lt;</span><span style="color: #47b7a0;" lang="en-US">uint8_t </span><span style="color: #979797;" lang="en-US">*&gt;</span><span style="color: #569cd6;" lang="en-US">(this)[i]; } \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">inline </span><span style="color: #47b7a0;" lang="en-US">uint8_t </span><span style="color: #c586c0;" lang="en-US">operator</span><span style="color: #989875;" lang="en-US">[]</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">size_t</span><span style="color: #569cd6;" lang="en-US"> i) const { </span><span style="color: #c586c0;" lang="en-US">return</span><span style="color: #569cd6;" lang="en-US"> reinterpret_cast</span><span style="color: #979797;" lang="en-US">&lt;</span><span style="color: #569cd6;" lang="en-US">const </span><span style="color: #47b7a0;" lang="en-US">uint8_t </span><span style="color: #979797;" lang="en-US">*&gt;</span><span style="color: #569cd6;" lang="en-US">(this)[i]; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">LOCATION_ALT_MAX_M </span><span style="color: #899c7f;" lang="en-US">83000 </span><span style="color: #608b4e;" lang="en-US">// maximum altitude (in meters) that can be fit into Location structure's alt field</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">check if bit bitnumber is set in value, returned as a</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">bool. Bitnumber starts at 0 for the first bit</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">BIT_IS_SET</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">value, bitnumber</span><span style="color: #569cd6;" lang="en-US">) (((value) </span><span style="color: #979797;" lang="en-US">&amp;</span><span style="color: #569cd6;" lang="en-US"> (</span><span style="color: #899c7f;" lang="en-US">1U</span><span style="color: #979797;" lang="en-US">&lt;&lt;</span><span style="color: #569cd6;" lang="en-US">(bitnumber))) </span><span style="color: #979797;" lang="en-US">!= </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #569cd6;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// get high or low bytes from 2 byte integer</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">LOWBYTE</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">i</span><span style="color: #569cd6;" lang="en-US">) ((</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #569cd6;" lang="en-US">)(i))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HIGHBYTE</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">i</span><span style="color: #569cd6;" lang="en-US">) ((</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #569cd6;" lang="en-US">)(((</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #569cd6;" lang="en-US">)(i))</span><span style="color: #979797;" lang="en-US">&gt;&gt;</span><span style="color: #899c7f;" lang="en-US">8</span><span style="color: #569cd6;" lang="en-US">))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">template </span><span style="color: #979797;" lang="en-US">&lt;</span><span style="color: #569cd6;" lang="en-US">typename</span><span style="color: #979797;" lang="en-US"> T, </span><span style="color: #47b7a0;" lang="en-US">size_t</span><span style="color: #979797;" lang="en-US"> N&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">char</span><span style="color: #979797;" lang="en-US"> (&amp;</span><span style="color: #989875;" lang="en-US">_ARRAY_SIZE_HELPER</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">T</span><span style="color: #979797;" lang="en-US"> (&amp;_arr)[N]))[N];</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">template </span><span style="color: #979797;" lang="en-US">&lt;</span><span style="color: #569cd6;" lang="en-US">typename</span><span style="color: #979797;" lang="en-US"> T&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">char</span><span style="color: #979797;" lang="en-US"> (&amp;</span><span style="color: #989875;" lang="en-US">_ARRAY_SIZE_HELPER</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">T</span><span style="color: #979797;" lang="en-US"> (&amp;_arr)[</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">]))[</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">];</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">ARRAY_SIZE</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">_arr</span><span style="color: #569cd6;" lang="en-US">) sizeof(</span><span style="color: #989875;" lang="en-US">_ARRAY_SIZE_HELPER</span><span style="color: #569cd6;" lang="en-US">(_arr))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* See UNUSED_RESULT. The difference is that it receives @uniq_ as the name to</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* be used for its internal variable.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* @uniq_: a unique name to use for variable name</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* @expr_: the expression to be evaluated</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">_UNUSED_RESULT</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">uniq_, expr_</span><span style="color: #569cd6;" lang="en-US">) \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">do</span><span style="color: #569cd6;" lang="en-US"> { \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">decltype</span><span style="color: #569cd6;" lang="en-US">(expr_) uniq_ </span><span style="color: #989875;" lang="en-US">__attribute__</span><span style="color: #569cd6;" lang="en-US">((unused)); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">uniq_ </span><span style="color: #979797;" lang="en-US">=</span><span style="color: #569cd6;" lang="en-US"> expr_; \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">} </span><span style="color: #c586c0;" lang="en-US">while</span><span style="color: #569cd6;" lang="en-US"> (</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #569cd6;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Allow to call a function annotated with warn_unused_result attribute</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* without getting a warning, because sometimes this is what we want to do.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* @expr_: the expression to be evaluated</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">UNUSED_RESULT</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">expr_</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #989875;" lang="en-US">_UNUSED_RESULT</span><span style="color: #569cd6;" lang="en-US">(__unique_name_##__COUNTER__, expr_)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// @}</p>
<p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;" lang="en-US">&nbsp;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">////////////////////////////////////////////////////////////////////////////////</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @name&nbsp;&nbsp;&nbsp;Types</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Data structures and types used throughout the libraries and applications. 0 = default</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 0: Altitude is stored 0: Absolute,&nbsp;&nbsp;&nbsp;&nbsp;1: Relative</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 1: Change Alt between WP 0: Gradually,&nbsp;&nbsp;&nbsp;1: ASAP</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 2: Direction of loiter command 0: Clockwise&nbsp;&nbsp;&nbsp;&nbsp;1: Counter-Clockwise</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 3: Req.to hit WP.alt to continue 0: No, 1: Yes</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 4: Relative to Home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0: No, 1: Yes</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 5: Loiter crosstrack reference 0: WP center 1: Tangent exit point</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 6:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// bit 7: Move to next Command 0: YES, 1: Loiter until commanded</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//@{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">PACKED</span><span style="color: #979797;" lang="en-US"> Location_Option_Flags {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> relative_alt : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// 1 if altitude is relateive to home</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> unused1 : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// unused flag (defined so that loiter_ccw uses the correct bit)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> loiter_ccw : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// 0 if clockwise, 1 if counter clockwise</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> terrain_alt : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// this altitude is above terrain</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> origin_alt : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// this altitude is above ekf origin</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> loiter_xtrack : </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// 0 to crosstrack from center of waypoint, 1 to crosstrack from tangent exit location</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">PACKED</span><span style="color: #979797;" lang="en-US"> Location {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Option_Flags flags; </span><span style="color: #608b4e;" lang="en-US">///&lt; options bitmask (1&lt;&lt;0 = relative altitude)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> options; </span><span style="color: #608b4e;" lang="en-US">/// allows writing all flags to eeprom as one byte</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// by making alt 24 bit we can make p1 in a command 16 bit,</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// allowing an accurate angle in centi-degrees. This keeps the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// storage cost per mission item at 15 bytes, and allows mission</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// altitudes of up to +/- 83km</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> alt:</span><span style="color: #899c7f;" lang="en-US">24</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 2 - Altitude in centimeters (meters * 100) see LOCATION_ALT_MAX_M</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> lat; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 3 - Latitude * 10**7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> lng; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 4 - Longitude * 10**7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">home states. Used to record if user has overridden home position.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> HomeState {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">HOME_UNSET, </span><span style="color: #608b4e;" lang="en-US">// home is unset, no GPS positions yet received</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">HOME_SET_NOT_LOCKED, </span><span style="color: #608b4e;" lang="en-US">// home is set to EKF origin or armed location (can be moved)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">HOME_SET_AND_LOCKED </span><span style="color: #608b4e;" lang="en-US">// home has been set by user, cannot be moved except by user initiated do-set-home command</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//@}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">////////////////////////////////////////////////////////////////////////////////</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @name&nbsp;&nbsp;&nbsp;Conversions</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Conversion macros and factors.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//@{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Return true if value is between lower and upper bound inclusive.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">False otherwise.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">is_bounded_int32</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> value, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> lower_bound, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> upper_bound);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_QURT</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_HAL_QURT/replace.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">useful debugging macro for SITL</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SITL</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">SITL_printf</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">fmt, args ...</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #c586c0;" lang="en-US">do</span><span style="color: #569cd6;" lang="en-US"> { </span><span style="color: #989875;" lang="en-US">::printf</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #cb8f76;" lang="en-US">"%s(%u): "</span><span style="color: #569cd6;" lang="en-US"> fmt, __FILE__, __LINE__, ##args); } </span><span style="color: #c586c0;" lang="en-US">while</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #569cd6;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#else</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">SITL_printf</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">fmt, args ...</span><span style="color: #569cd6;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p>Note that these attributes mentioned are for GCC <g class="gr_ gr_198 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="198" data-gr-id="198">compliers</g>, as such, it depends on the board. Don't worry about not knowing what these are <g class="gr_ gr_217 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling only-del replaceWithoutSep" id="217" data-gr-id="217"><g class="gr_ gr_215 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="215" data-gr-id="215">for</g> for</g> now, it will come up soon enough.</p>
<p>Here, "PACKED __attribute__((__packed__))" the word "PACKED" is being defined as something. The use of "__attribute__((__packed__))" means to use the smallest possible space to store the data of a function. So a "typedef struct {&hellip;.} __attribute__((__packed__))" will have its storage shrunk to the smallest size possible. This is because some systems automatically convert the size of objects to a set size, this is to allow for better performance, this is what known as "Data structure padding", an effect caused by data alignment, that is, there are specific sizes that the CPU likes of which the system will align the data to and data structure padding adds in meaningless bytes to adjust the size of the data, thus causing alignment.</p>
<p>&nbsp;</p>
<p>UNUSED_FUNCTION is defined by "UNUSED_FUNCTION __attribute__((unused))" what this does is prevents the <g class="gr_ gr_214 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="214" data-gr-id="214">complier</g> from generating any error if the function is not referenced. This occurs when a value/datum is created but is not used. Adding the attribute unused stops this error from being generated.</p>
<p>&nbsp;</p>
<p>"#define OPTIMIZE(level) __attribute__((optimize(level)))" basically sets the level of optimization, that is how the GCC <g class="gr_ gr_201 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="201" data-gr-id="201">complier</g> complies things. Different levels result in different amount of changes with 0 being the lowest. This is used should we not want the <g class="gr_ gr_202 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="202" data-gr-id="202">complier</g> to overly optimize itself for our code. By giving "OPTIMIZE(Level) that definition, we can use it to optimize individual functions.</p>
<p>&nbsp;</p>
<p>"#define NOINLINE __attribute__((<g class="gr_ gr_212 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="212" data-gr-id="212">noinline</g>))" An inline function is a function where when declared to be inline and has been defined by unknowns like x <g class="gr_ gr_209 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="209" data-gr-id="209">and y</g>, the inline function can be used inside another function by simply replacing the x <g class="gr_ gr_210 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="210" data-gr-id="210">and y</g> values without having to first assign x <g class="gr_ gr_211 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="211" data-gr-id="211">and y</g>. We need to make a definition for <g class="gr_ gr_213 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="213" data-gr-id="213">noinline</g> as a function definition in a class definition is automatically an inline function definition.</p>
<p>&nbsp;</p>
<p>"#define FMT_PRINTF(a,b) __attribute__((format(<g class="gr_ gr_206 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="206" data-gr-id="206">printf</g>, a, b)))" This checks the format of the function it's applied on and see if the supplied arguments for the function matches the correct format. The thing it is comparing to is the values you give (a and b) with the arguments of the function. The function, <g class="gr_ gr_207 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="207" data-gr-id="207">printf</g>, prints the data to stdout. So when the arguments <g class="gr_ gr_228 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="228" data-gr-id="228">is</g> in the wrong format, <g class="gr_ gr_208 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="208" data-gr-id="208">printf</g> will print an error to your debug console. This makes debugging easier.</p>
<p>&nbsp;</p>
<p>"#define FMT_SCANF(a,b) __attribute__((format(<g class="gr_ gr_242 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="242" data-gr-id="242">scanf</g>, a, b)))" this is similar to <g class="gr_ gr_243 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="243" data-gr-id="243">printf</g> and is still use to check for formats but this time for extreme ones. Scanf <g class="gr_ gr_230 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="230" data-gr-id="230">is use</g> for reading data from stdin should there be any compiling error due to the function assigned that cannot be found from <g class="gr_ gr_244 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="244" data-gr-id="244">printf</g>. By doing so, we can check what is inputted and perhaps find the error from there should we fail to do so with <g class="gr_ gr_245 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="245" data-gr-id="245">printf</g>.</p>
<p>&nbsp;</p>
<p>"</p>
<p>#define ToRad(x) radians(x)&nbsp;// *pi/180</p>
<p>#define ToDeg(x) degrees(x)&nbsp;// *180/pi</p>
<p>" Basic stuff, radians and degrees are both functions (and they are units for angles in Math)</p>
<p>&nbsp;</p>
<p>"#define BIT_IS_SET(value, <g class="gr_ gr_218 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="218" data-gr-id="218">bitnumber</g>) (((value) &amp; (1U&lt;&lt;(<g class="gr_ gr_219 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="219" data-gr-id="219">bitnumber</g>))) != 0)" what this does is that is checks if the bit value of the <g class="gr_ gr_220 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="220" data-gr-id="220">bitnumber</g> is set in value, that is if it is used/assigned. A bit number is the position of the bit in question, it is a method to identify the bits in a container; this method is known as bit numbering. Here, "1U&lt;&lt;(<g class="gr_ gr_221 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="221" data-gr-id="221">bitnumber</g>)" shifts the <g class="gr_ gr_222 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="222" data-gr-id="222">bitnumber</g> to the left by 1. In other words, it increases the value of the <g class="gr_ gr_223 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="223" data-gr-id="223">bitnumber</g> by 1, so from 3 to 4. It then checks if it "does not equal" to zero and thus <g class="gr_ gr_260 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="260" data-gr-id="260">return</g> either true or false. It will return true if it does not equal to zero and false of it equals zero. We need to shift it by one because the first bit starts at zero, as such the numbering is always 1 off, much like vectors.</p>
<p>&nbsp;</p>
<p>"#define LOWBYTE(i) ((uint8_t)(i))" is basically defining LOWBYTE as a byte of 8 bits. This is because "uin8_t" stands for <g class="gr_ gr_252 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="252" data-gr-id="252">unsigned</g> integer of length 8 bits and is itself a type. Now "i" is assigned this type and is given the name LOWBYTE with the same value. What this all does is to turn a <g class="gr_ gr_255 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="255" data-gr-id="255">2 byte</g> integer into a low byte by assigning it to the type uin8_t and naming it <g class="gr_ gr_254 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="254" data-gr-id="254">as</g> low byte. As 8 bits is 1 byte, the 2 <g class="gr_ gr_256 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="256" data-gr-id="256">byte</g> is turned smaller.</p>
<p>&nbsp;</p>
<p>"#define HIGHBYTE(i) ((uint8_t)(((uint16_t)(i))&gt;&gt;8))" is the counterpart to the above and turns 2 bytes into a high byte. This shifts the byte by 8 to the right and assigned it to uint16_t which is just 16 instead of 8 in uint8_t. All of which is given the type uint8_t and divided into multiple chunks of 8 bits and thus form a high byte.</p>
<p>&nbsp;</p>
<p>"template &lt;typename T, size_t N&gt;" creates a template where we can assign a type instead of first determining what the type will be. Here, '<g class="gr_ gr_225 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="225" data-gr-id="225">typename</g>" of which is denoted T is the argument of which the type can be assigned to. So T can be assigned the type int, or string etc. "size_t" is a specific type denoted N in this case.</p>
<p>"char (&amp;_ARRAY_SIZE_HELPER(T (&amp;_arr)[N]))[N];" uses the template to place a placeholder type into the function defined earlier. So type can now be determined and is not set.</p>
<p>"#define ARRAY_SIZE(_arr) <g class="gr_ gr_204 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="204" data-gr-id="204">sizeof</g>(_ARRAY_SIZE_HELPER(_arr))" make use of the function "<g class="gr_ gr_205 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="205" data-gr-id="205">sizeof</g>" that checks the size of the argument inside the parenthesis. In this case, it checks the size of "(_ARRAY_SIZE_HELPER(_arr)" in bytes and returns it.</p>
<p>Here we see the use of PACKED in the creation of this struct, Location_Option_Flags. This packs all of the details resulting from the drone on its journey from <g class="gr_ gr_277 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="277" data-gr-id="277">ground</g> station. These factors are stored in uint8_t and are related to the altitudes for the journey. This allows us to set things later on with <g class="gr_ gr_279 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="279" data-gr-id="279">these information</g> at hand. Refer to above for what 1 and 0 mean respectively.</p>
<p>"PACKED Location" is similar but this time it's stored in int32_t because it is to hold locations, that is altitude, <g class="gr_ gr_292 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="292" data-gr-id="292">latitude</g> and longitude. As such, more bytes are needed.</p>
<p>The functions within the enum "HomeState" is defined elsewhere. Enum allows for easy <g class="gr_ gr_304 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="304" data-gr-id="304">refering</g> as each function in <g class="gr_ gr_305 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="305" data-gr-id="305">enum</g> is assigned a number by default, starting from 0 and up.</p>
<p>is_bounded_int32 is a function defined elsewhere of which compares the value between the lower boundary of <g class="gr_ gr_320 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="320" data-gr-id="320">int32_t</g> and upper boundary, returning true if <g class="gr_ gr_321 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="321" data-gr-id="321">value</g> is between lower and upper boundary. Note that this does not do the returning, it merely determines whether it's true or false.</p>
<p>"#if CONFIG_HAL_BOARD == HAL_BOARD_QURT" and the following code are board specific, they require special headers. QURT is the "Qualcomm Snapdragon Flight Kit" and is named so due to the fact that it connects QURT port.</p>
<p>"#if CONFIG_HAL_BOARD == HAL_BOARD_SITL" is for the simulation, just leave it as it is.</p>[/et_pb_tab][et_pb_tab title="COMMON.cpp" _builder_version="3.0.51"]<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_HAL/AP_HAL.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_Common.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">extern</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> AP_HAL::HAL&amp; hal;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Return true if value is between lower and upper bound inclusive.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">False otherwise.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">is_bounded_int32</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> value, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> lower_bound, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> upper_bound)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> ((lower_bound &lt;= upper_bound) &amp;&amp;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">(value &gt;= lower_bound) &amp;&amp; (value &lt;= upper_bound)) {</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p>"<g class="gr_ gr_9 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="9" data-gr-id="9">extern</g>" tells the <g class="gr_ gr_6 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="6" data-gr-id="6">complier</g> that the variable is defined elsewhere in the source code. Because the <g class="gr_ gr_7 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="7" data-gr-id="7">complier</g> reads from up then down, should the variable be defined elsewhere other than above the variable it would miss <g class="gr_ gr_10 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation multiReplace" id="10" data-gr-id="10">it.</g> Using extern tells the <g class="gr_ gr_8 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="8" data-gr-id="8">complier</g> to search for the variable.</p>
<p>The function is_bounded is board dependent thus we need to include HAL at the start.</p>
<p><g class="gr_ gr_16 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="16" data-gr-id="16">Same</g> function we <g class="gr_ gr_17 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="17" data-gr-id="17">seen</g> previously but this time it can now be used to return true if <g class="gr_ gr_15 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="15" data-gr-id="15">value</g> is between lower and upper bound.</p>[/et_pb_tab][et_pb_tab title="TEST.h" _builder_version="3.0.51"]<p>Here, we have a generalization test from which we can test different things. An example of such is testing if the board currently being used have serial ports. To use this test, each test must be put within a block as either a function or a block within a function. The macro "TEST" starts the test and creates a local object that will track the results of the test and saves it with a name for reporting later. There can only be one test within each block.</p>
<p>The macro "REQUIRE" can be used to describe the condition that must be met for the test to pass. Should the condition not be met, the condition will be outputted as a diagnostic and the test will be considered a failure. The end of each block is considered as the end of the test and the test results will be outputted as a diagnostic.</p>
<p>As an additional function, <g class="gr_ gr_25 gr-alert gr_gramm gr_inline_cards gr_run_anim Style replaceWithoutSep" id="25" data-gr-id="25">"Test::report"</g> can be used to summarize the results of all tests that were performed. This is placed at the end of the file of all the tests.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @file AP_Test.h</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @brief A simple unit test framework.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// AP_Test provides the usual test start, condition validation and reporting</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// functions in a compact form.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Unit test state and methods.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Test</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Constructor - creates a new test.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Normally called by the TEST macro.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @param name The name of the test being started.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Test</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const char</span><span style="color: #979797;" lang="en-US"> *name);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Destructor - ends the test.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">~Test</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Perform a success check.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @param expr If false, the test has failed.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// @param source The expression source; emitted in the diagnostic</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// indicating test failure.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">require</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">bool</span><span style="color: #979797;" lang="en-US"> expr, </span><span style="color: #569cd6;" lang="en-US">const char</span><span style="color: #979797;" lang="en-US"> *source);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Report the overall number of tests/pass/fails.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">report</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">private:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">const</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">char</span><span style="color: #979797;" lang="en-US"> *_name; </span><span style="color: #608b4e;" lang="en-US">///&lt; name of the current test</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> _fail; </span><span style="color: #608b4e;" lang="en-US">///&lt; set if any ::require calls indicate the test failed</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">int16_t</span><span style="color: #979797;" lang="en-US"> _passed; </span><span style="color: #608b4e;" lang="en-US">///&lt; global pass count</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">int16_t</span><span style="color: #979797;" lang="en-US"> _failed; </span><span style="color: #608b4e;" lang="en-US">///&lt; global fail count</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Constructor</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Test::Test</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const char</span><span style="color: #979797;" lang="en-US"> *name) :</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">_name</span><span style="color: #979797;" lang="en-US">(name),</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">_fail</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Destructor</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Test::~Test</span><span style="color: #979797;" lang="en-US">()</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Serial.</span><span style="color: #989875;" lang="en-US">printf</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #cb8f76;" lang="en-US">"%s: %s\n"</span><span style="color: #979797;" lang="en-US">, _fail ? </span><span style="color: #cb8f76;" lang="en-US">"FAILED"</span><span style="color: #979797;" lang="en-US"> : </span><span style="color: #cb8f76;" lang="en-US">"passed"</span><span style="color: #979797;" lang="en-US">, _name);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_fail) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">_failed++;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">} </span><span style="color: #c586c0;" lang="en-US">else</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">_passed++;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Success check</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">void</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Test::require</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">bool</span><span style="color: #979797;" lang="en-US"> expr, </span><span style="color: #569cd6;" lang="en-US">const char</span><span style="color: #979797;" lang="en-US"> *source)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!expr) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_fail = </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Serial.</span><span style="color: #989875;" lang="en-US">printf</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #cb8f76;" lang="en-US">"%s: fail: %s\n"</span><span style="color: #979797;" lang="en-US">, _name, source);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Summary report</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">void</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Test::report</span><span style="color: #979797;" lang="en-US">()</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Serial.</span><span style="color: #989875;" lang="en-US">printf</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #cb8f76;" lang="en-US">"\n%d passed %d failed\n"</span><span style="color: #979797;" lang="en-US">, _passed, _failed);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int16_t</span><span style="color: #979797;" lang="en-US"> Test::_passed = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int16_t</span><span style="color: #979797;" lang="en-US"> Test::_failed = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Start a new test.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">TEST</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">name</span><span style="color: #569cd6;" lang="en-US">) Test </span><span style="color: #989875;" lang="en-US">_test</span><span style="color: #569cd6;" lang="en-US">(# name)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// Attach an expression to the test's success criteria.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// The expression expr must evaluate true for the test to pass. If</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// it does not, the text of the expression is output as a diagnostic</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// and the test is marked as a failure.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">///</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">REQUIRE</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">expr</span><span style="color: #569cd6;" lang="en-US">) _test.</span><span style="color: #989875;" lang="en-US">require</span><span style="color: #569cd6;" lang="en-US">(expr, # expr)</span></p>
<p>A constructor is part of a class of which is executed when a new object of that class is created. A constructor will always have the same name as the class it is created from and does not have a type to be returned. It is mostly used to set required arguments for the users to enter. Here, "Test(const char *name);" is the constructor and requires you to enter a name for the test. "Const" to make it unchangeable so it can be kept in check.</p>
<p>If a constructor creates an object, a destructor is used to destroy the object. It does so by freeing the resources that the object may have used, such as memory. This is important as if the resources the object used is not destroyed even after it has <g class="gr_ gr_107 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="107" data-gr-id="107">finish</g> using it, it might build up and eventually use up all the resources available. Here, "~Test();" is the destructor.</p>
<p>&nbsp;Here the function "require" is defined to set the parameters required for it to work. "<g class="gr_ gr_97 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="97" data-gr-id="97">expr</g>" is a Boolean and is used to store either true or false when it is determined. "*source" houses the diagnostic, used when <g class="gr_ gr_103 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="103" data-gr-id="103">test</g> failed.&nbsp;</p>
<p><g class="gr_ gr_119 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="119" data-gr-id="119">Report</g> is defined here as well and static. Static functions, when used inside a class definition makes is so that it does not require an instance of the class. That is it does not need the class and is merely there for tidiness. Also, they do not belong to specific instances of <g class="gr_ gr_121 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="121" data-gr-id="121">class</g>. As such, it can only operate on members that are static as well, for it does not have access to other non-static members of the class.</p>
<p>The reason why there is only "_fail" is <g class="gr_ gr_91 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="91" data-gr-id="91">because</g> otherwise, it would just be true.</p>
<p>The parts that are private are not to be modified by the user, those that are in private are not accessible to users. Just so they aren't tampered with. Variables that are static makes is so that they have the same value in any instance of the class, "passed" will always be "passed".</p>
<p>Here the constructor is defined and the use of ":" is to immediately initialize "_name" with "name" and "_false" with "false". By doing so, we make sure that they are indeed initialized before anything happens and are done so because "_name" and "_false" is private. Therefore, we make sure that the true value for name and false are true, just in case the user accessible variables "name" and "false" are edited. It is merely an initialization so it's an empty function.</p>
<p>The destructor is defined here as well. Serial is part of Arduino and is used to communicate with an Arduino board. "serial.<g class="gr_ gr_98 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="98" data-gr-id="98">printf</g>" prints to an output and "%s" <g class="gr_ gr_101 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="101" data-gr-id="101">specifies</g> the following output to be a string.</p>
<p>The syntax "?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; :" is just if-else so if it failed, it will print out fail and otherwise, print out "passed" with its name.</p>
<p>The use of "++" in "_failed++" increments "_failed++" by one. Remember it is used to count the number of failures and as such when one failed, it increases the value of "_failed++" by one. Otherwise, "_passed" is incremented by one.&nbsp;</p>
<p>Now "require" is defined, in which if "<g class="gr_ gr_86 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="86" data-gr-id="86">expr</g>" is false, that is "!<g class="gr_ gr_87 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="87" data-gr-id="87">expr</g>"-"!" indicates false, then "_fail" is true, that is failure occurred. As such, the failure <g class="gr_ gr_99 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="99" data-gr-id="99">statement</g> is printed.</p>
<p>"report()" prints out <g class="gr_ gr_96 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="96" data-gr-id="96">the amount of</g> failures and passes incremented from the above increments.</p>
<p>&nbsp;Here "_passed" and "_failed" are each initialized by zero by default.&nbsp;</p>
<p>The definition of "TEST" is the macro that starts a new test. The use of it starts a new test and creates an object called "_test" with type Test that is initialized with a name. It must be invoked at the beginning of the test block. So before any "REQUIRE" statements and any "REQUIRE" statements after this will be applied to the test. The test will continue until the end of the block is reached or until the created test object goes out of scope.</p>
<p>This macro for "REQUIRE" is an instance of the object "_test" of <g class="gr_ gr_145 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="145" data-gr-id="145">class</g> test and has been assigned "<g class="gr_ gr_143 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="143" data-gr-id="143">expr</g>". For the test to pass, "<g class="gr_ gr_144 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="144" data-gr-id="144">expr</g>" must be evaluated to be true. Should it not be true, the text of the expression (source) is outputted as diagnostic and the test is marked as failed.</p>[/et_pb_tab][et_pb_tab title="BITMASK.h" _builder_version="3.0.51"]<p>A mask is essentially a certain binary number you set to operate on another binary number that you may or may not know. It is mostly used to single out specific bits in a byte of data, by "combining-AND" the binary numbers together and check the output.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">simple bitmask class</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Bitmask</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Bitmask</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> numbits) :</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">numwords</span><span style="color: #979797;" lang="en-US">((numbits+</span><span style="color: #899c7f;" lang="en-US">31</span><span style="color: #979797;" lang="en-US">)/</span><span style="color: #899c7f;" lang="en-US">32</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">bits = </span><span style="color: #c586c0;" lang="en-US">new </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US">[numwords];</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">~Bitmask</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">delete[]</span><span style="color: #979797;" lang="en-US"> bits;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// set given bitnumber</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> bit) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint16_t</span><span style="color: #979797;" lang="en-US"> word = bit/</span><span style="color: #899c7f;" lang="en-US">32</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> ofs = bit &amp; </span><span style="color: #899c7f;" lang="en-US">0x1f</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">bits[word] |= (</span><span style="color: #899c7f;" lang="en-US">1U</span><span style="color: #979797;" lang="en-US"> &lt;&lt; ofs);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// clear given bitnumber</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">clear</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> bit) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint16_t</span><span style="color: #979797;" lang="en-US"> word = bit/</span><span style="color: #899c7f;" lang="en-US">32</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> ofs = bit &amp; </span><span style="color: #899c7f;" lang="en-US">0x1f</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">bits[word] &amp;= ~(</span><span style="color: #899c7f;" lang="en-US">1U</span><span style="color: #979797;" lang="en-US"> &lt;&lt; ofs);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// clear all bits</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">clearall</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">for</span><span style="color: #979797;" lang="en-US"> (</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> i=</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; i&lt;numwords; i++) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">bits[i] = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return true if given bitnumber is set</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> bit) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint16_t</span><span style="color: #979797;" lang="en-US"> word = bit/</span><span style="color: #899c7f;" lang="en-US">32</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> ofs = bit &amp; </span><span style="color: #899c7f;" lang="en-US">0x1f</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> (bits[word] &amp; (</span><span style="color: #899c7f;" lang="en-US">1U</span><span style="color: #979797;" lang="en-US"> &lt;&lt; ofs)) != </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return true if all bits are clear</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">empty</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">for</span><span style="color: #979797;" lang="en-US"> (</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> i=</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; i&lt;numwords; i++) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (bits[i] != </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">private:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint16_t</span><span style="color: #979797;" lang="en-US"> numwords;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint32_t</span><span style="color: #979797;" lang="en-US"> *bits;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>[/et_pb_tab][et_pb_tab title="C++.cpp" _builder_version="3.0.51"]<p>This is here to address runtime support not provided by Arduino.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// C++ runtime support not provided by Arduino</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">//</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// Note: use new/delete with caution. The heap is small and</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// easily fragmented.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_HAL/AP_HAL.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;stdlib.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">globally override new and delete to ensure that we always start with</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">zero memory. This ensures consistent behaviour.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> * </span><span style="color: #c586c0;" lang="en-US">operator new</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">size_t</span><span style="color: #979797;" lang="en-US"> size)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (size &lt; </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">size = </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">calloc</span><span style="color: #979797;" lang="en-US">(size, </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">));</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #c586c0;" lang="en-US">operator delete</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US"> *p)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (p) </span><span style="color: #989875;" lang="en-US">free</span><span style="color: #979797;" lang="en-US">(p);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> * </span><span style="color: #c586c0;" lang="en-US">operator new</span><span style="color: #979797;" lang="en-US">[](</span><span style="color: #47b7a0;" lang="en-US">size_t</span><span style="color: #979797;" lang="en-US"> size)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (size &lt; </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">size = </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">calloc</span><span style="color: #979797;" lang="en-US">(size, </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">));</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #c586c0;" lang="en-US">operator delete[]</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US"> * ptr)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (ptr) </span><span style="color: #989875;" lang="en-US">free</span><span style="color: #979797;" lang="en-US">(ptr);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p>Here, the definition of "new" is altered so as to address the size of created object. The "size_t" is within Arduino.</p>
<p>"<g class="gr_ gr_21 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="21" data-gr-id="21">calloc</g>" allocates a block of memory depending on the arguments. Its format is as follows: <g class="gr_ gr_22 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="22" data-gr-id="22">calloc</g> (size_t num, size_t size); where "num" is the number of such elements and "size" is the size of each element. As such, returns the pointer to a memory with a "size" number of elements and each element with size "1".&nbsp;</p>
<p>"Delete" is being altered as well so as to free the element of a pointer it is pointed at. With free being within the Arduino library.</p>
<p>Using new[] now has the same meaning as new and that goes for delete as well. Except that delete[] is stored in another pointer just in case it tries to free the same pointer of which will not end well.</p>[/et_pb_tab][et_pb_tab title="Keywords" _builder_version="3.0.51"]<p>Menu KEYWORD1</p>
<p>run KEYWORD2</p>
<p>Location KEYWORD2</p>[/et_pb_tab][et_pb_tab title="LOCATION.h" _builder_version="3.0.51"]<p>This is a header file for computing location and contain variables to aid in the using of locations by the drone. The key factors involved in location are the latitude, <g class="gr_ gr_7 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="7" data-gr-id="7">longitudes</g> and altitude. These are all stored in int32_t instead of int8_t as they are decently sized in size.</p>
<p>This is part of what makes the mission planner and is used to store information in relation to missions about the location. Note that most functions are defined in location.<g class="gr_ gr_16 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="16" data-gr-id="16">cpp</g>, as headers serve as a place to put generalized contents that might've different impacts elsewhere in the source code but with the same common features.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">PACKED</span><span style="color: #979797;" lang="en-US"> Location {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Option_Flags flags; </span><span style="color: #608b4e;" lang="en-US">///&lt; options bitmask (1&lt;&lt;0 = relative altitude)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> options; </span><span style="color: #608b4e;" lang="en-US">/// allows writing all flags to <g class="gr_ gr_165 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="165" data-gr-id="165">eeprom</g> as one byte</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// by making alt 24 bit we can make p1 in a command 16 bit,</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// allowing an accurate angle in <g class="gr_ gr_166 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="166" data-gr-id="166">centi</g>-degrees. This keeps the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// storage cost per mission item at 15 bytes, and allows mission</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// altitudes of up to +/- 83km</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> alt:</span><span style="color: #899c7f;" lang="en-US">24</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 2 - Altitude in centimeters (meters * 100) see LOCATION_ALT_MAX_M</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> lat; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 3 - Latitude * 10**7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> <g class="gr_ gr_167 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="167" data-gr-id="167">lng</g>; </span><span style="color: #608b4e;" lang="en-US">///&lt; param 4 - Longitude * 10**7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">LOCATION_H</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">LOCATION_H</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_Common/AP_Common.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_Math/AP_Math.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_HAL/AP_HAL.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_AHRS_NavEKF</span><span style="color: #569cd6;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_Terrain</span><span style="color: #569cd6;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Location_Class</span><span style="color: #979797;" lang="en-US"> : </span><span style="color: #569cd6;" lang="en-US">public </span><span style="color: #47b7a0;" lang="en-US">Location</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// enumeration of possible altitude types</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> ALT_FRAME {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ALT_FRAME_ABSOLUTE = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ALT_FRAME_ABOVE_HOME = </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ALT_FRAME_ABOVE_ORIGIN = </span><span style="color: #899c7f;" lang="en-US">2</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ALT_FRAME_ABOVE_TERRAIN = </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// constructors</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> latitude, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> longitude, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> alt_in_cm, ALT_FRAME frame);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> Location&amp; loc);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> Vector3f &amp;ekf_offset_neu);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// accept reference to ahrs and (indirectly) EKF</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_ahrs</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> AP_AHRS_NavEKF* ahrs) { _ahrs = ahrs; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_terrain</span><span style="color: #979797;" lang="en-US">(AP_Terrain* terrain) { _terrain = terrain; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// operators</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Class&amp; </span><span style="color: #c586c0;" lang="en-US">operator</span><span style="color: #979797;" lang="en-US">=(</span><span style="color: #569cd6;" lang="en-US">const struct </span><span style="color: #47b7a0;" lang="en-US">Location</span><span style="color: #979797;" lang="en-US"> &amp;loc);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// set altitude</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_alt_cm</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> alt_cm, ALT_FRAME frame);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// get altitude (in cm) in the desired frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// returns false on failure to get altitude in the desired frame which</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// can only happen if the original frame or desired frame is above-terrain</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_alt_cm</span><span style="color: #979797;" lang="en-US">(ALT_FRAME desired_frame, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> &amp;ret_alt_cm) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// get altitude frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ALT_FRAME </span><span style="color: #989875;" lang="en-US">get_alt_frame</span><span style="color: #979797;" lang="en-US">() </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// converts altitude to new frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// returns false on failure to convert which can only happen if</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// the original frame or desired frame is above-terrain</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">change_alt_frame</span><span style="color: #979797;" lang="en-US">(ALT_FRAME desired_frame);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// get position as a vector from home (x,y only or x,y,z)</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return false on failure to get the vector which can only</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// happen if the EKF origin has not been set yet</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_vector_xy_from_origin_NEU</span><span style="color: #979797;" lang="en-US">(Vector3f &amp;vec_neu) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_vector_from_origin_NEU</span><span style="color: #979797;" lang="en-US">(Vector3f &amp;vec_neu) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return distance in meters between two locations</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">float</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_distance</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const struct</span><span style="color: #979797;" lang="en-US"> Location &amp;loc2) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// extrapolate latitude/longitude given distances (in meters) north and east</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">offset</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US"> ofs_north, </span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US"> ofs_east);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">is_zero</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) { </span><span style="color: #c586c0;" lang="en-US">return</span><span style="color: #979797;" lang="en-US"> (lat == </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US"> &amp;&amp; lng == </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US"> &amp;&amp; alt == </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US"> &amp;&amp; options == </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">); }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">zero</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) { lat = lng = alt = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; options = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">private:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> AP_AHRS_NavEKF *_ahrs;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> AP_Terrain *_terrain;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#endif</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #608b4e;" lang="en-US">/* LOCATION_H */</span></p>
<p>Here "location_class" inherited "location" of which is put as <g class="gr_ gr_96 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="96" data-gr-id="96">reference</g> here:</p>
<p><g class="gr_ gr_98 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="98" data-gr-id="98">Public</g> is used just so everything in location is made public members of "location_class" this is because "class" is innately private, that is anything not declared as part of <g class="gr_ gr_101 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="101" data-gr-id="101">public</g> is made private. So even though everything in "location" is already public, if we did not <g class="gr_ gr_103 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="103" data-gr-id="103">specific</g> it to be inherited as public then it would be made private.</p>
<p>Altitude <g class="gr_ gr_85 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="85" data-gr-id="85">have</g> different types:</p>
<p>"ALT_FRAME_ABSOLUTE" Absolute altitude is the height above sea level</p>
<p>"ALT_FRAME_ABOVE_HOME" The altitude set for the "Return home" <g class="gr_ gr_86 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="86" data-gr-id="86">function .</g> This altitude will be the altitude maintained by the drone when it is returning <g class="gr_ gr_87 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="87" data-gr-id="87">home .</g> So this is the altitude type should the drone be above or at home altitude</p>
<p>"ALT_FRAME_ABOVE_ORIGIN" The origin is a point set by the Extended Kalman Filtering</p>
<p>"ALT_FRAME_ABOVE_TERRAIN" Terrain altitude is the height above ground level based on <g class="gr_ gr_84 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="84" data-gr-id="84">google</g> terrain information</p>
<p>These altitude types are called frames, as in a frame of reference.</p>
<p>The "location_class" is used to store the location through latitude, longitude, altitude and even included the altitude type that can be set. As such, the constructor reflects that and is used by the mission planner to store data on missions. It also <g class="gr_ gr_89 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="89" data-gr-id="89">allow</g> for a reference to an already made location of type "location"-Refer back to it if you want to know how. It is made constant so as not to be altered through "location".</p>
<p>"<g class="gr_ gr_77 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="77" data-gr-id="77">ahrs</g>" stands for Altitude heading reference system and is acquired through Extended Kalman Filtering. As such "set_ahrs" takes a pointer argument from AHRS of EKF and assigns it to a reference "_ahrs" of which is declared in private. These are made "static" so as to be able to be called even when no objects of the class <g class="gr_ gr_93 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="93" data-gr-id="93">has</g> been created, as they don&rsquo;t need any. The same applies to "set_terrain".</p>
<p>Here, the operator "=" is ready to be customized using "location".</p>
<p>"get.alt.cm" acquires the altitude in cm based on the frame chosen. It returns a Boolean and will return a false if it fails to get the altitude of the desired frame which would only occur if the frame chosen is "Above_terrain". So if "Above_terrain" is chosen, a false will be returned. If any other frames are chosen and the drone is "above_terrain" in terms of altitude, a false will be returned as well. This will all be coded in location.cpp.</p>
<p>"vector_xy" means from x and <g class="gr_ gr_68 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="68" data-gr-id="68">y axis</g> only.</p>
<p>"vector" means from x, y and <g class="gr_ gr_69 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="69" data-gr-id="69">z axis</g>.</p>
<p>The two will return a false when it failed to get the vector which only occurs when the EKF origin has not been set yet.</p>
<p>By placing "const" at the end of a function declaration inside a class, it makes it so that it becomes a complier error should the class function changes a member variable of the class. Basically, if it edits a member of the class an error will occur. It is allowed to read member variables of the class but is not allowed to write. This is to avoid external sources contaminating innate data.&nbsp;</p>
<p>A float is used as <g class="gr_ gr_81 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins replaceWithoutSep" id="81" data-gr-id="81">distance</g> is measured in meters in the mission planner/<g class="gr_ gr_80 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="80" data-gr-id="80">ardupilot</g> and does not have to hold anything insanely large for earth-bound UAV.</p>[/et_pb_tab][et_pb_tab title="LOCATION.cpp" _builder_version="3.0.51"]<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Location.cpp</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Location.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_AHRS/AP_AHRS.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_AHRS/AP_AHRS_NavEKF.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">&lt;AP_Terrain/AP_Terrain.h&gt;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">extern</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> AP_HAL::HAL&amp; hal;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">const</span><span style="color: #979797;" lang="en-US"> AP_AHRS_NavEKF *Location_Class::_ahrs = </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">AP_Terrain *Location_Class::_terrain = </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// constructors</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class::Location_Class</span><span style="color: #979797;" lang="en-US">()</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">zero</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class::Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> latitude, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> longitude, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> alt_in_cm, ALT_FRAME frame)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">lat = latitude;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">lng = longitude;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">options = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">set_alt_cm</span><span style="color: #979797;" lang="en-US">(alt_in_cm, frame);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class::Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> Location&amp; loc)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lat = loc.</span><span style="color: #72a1ba;" lang="en-US">lat</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lng = loc.</span><span style="color: #72a1ba;" lang="en-US">lng</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">alt = loc.</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">options = loc.</span><span style="color: #72a1ba;" lang="en-US">options</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Location_Class::Location_Class</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> Vector3f &amp;ekf_offset_neu)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// store alt and alt frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">set_alt_cm</span><span style="color: #979797;" lang="en-US">(ekf_offset_neu.</span><span style="color: #72a1ba;" lang="en-US">z</span><span style="color: #979797;" lang="en-US">, ALT_FRAME_ABOVE_ORIGIN);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// calculate lat, lon</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_ahrs != </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">Location ekf_origin;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_origin</span><span style="color: #979797;" lang="en-US">(ekf_origin)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lat = ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">lat</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lng = ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">lng</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">offset</span><span style="color: #979797;" lang="en-US">(ekf_offset_neu.</span><span style="color: #72a1ba;" lang="en-US">x</span><span style="color: #979797;" lang="en-US"> / </span><span style="color: #899c7f;" lang="en-US">100.0f</span><span style="color: #979797;" lang="en-US">, ekf_offset_neu.</span><span style="color: #72a1ba;" lang="en-US">y</span><span style="color: #979797;" lang="en-US"> / </span><span style="color: #899c7f;" lang="en-US">100.0f</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Class&amp; Location_Class::</span><span style="color: #c586c0;" lang="en-US">operator</span><span style="color: #979797;" lang="en-US">=(</span><span style="color: #569cd6;" lang="en-US">const struct </span><span style="color: #47b7a0;" lang="en-US">Location</span><span style="color: #979797;" lang="en-US"> &amp;loc)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lat = loc.</span><span style="color: #72a1ba;" lang="en-US">lat</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">lng = loc.</span><span style="color: #72a1ba;" lang="en-US">lng</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">alt = loc.</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">options = loc.</span><span style="color: #72a1ba;" lang="en-US">options</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> *</span><span style="color: #569cd6;" lang="en-US">this</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::set_alt_cm</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> alt_cm, ALT_FRAME frame)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">alt = alt_cm;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">relative_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">terrain_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">origin_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">switch</span><span style="color: #979797;" lang="en-US"> (frame) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABSOLUTE:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// do nothing</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_HOME:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">relative_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_ORIGIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">origin_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_TERRAIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// we mark it as a relative altitude, as it doesn't have</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// home alt added</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">relative_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">flags.</span><span style="color: #72a1ba;" lang="en-US">terrain_alt</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// converts altitude to new frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::change_alt_frame</span><span style="color: #979797;" lang="en-US">(ALT_FRAME desired_frame)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> new_alt_cm;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!</span><span style="color: #989875;" lang="en-US">get_alt_cm</span><span style="color: #979797;" lang="en-US">(desired_frame, new_alt_cm)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">set_alt_cm</span><span style="color: #979797;" lang="en-US">(new_alt_cm, desired_frame);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// get altitude frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Class::ALT_FRAME </span><span style="color: #989875;" lang="en-US">Location_Class::get_alt_frame</span><span style="color: #979797;" lang="en-US">() </span><span style="color: #569cd6;" lang="en-US">const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (flags.</span><span style="color: #72a1ba;" lang="en-US">terrain_alt</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_TERRAIN;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (flags.</span><span style="color: #72a1ba;" lang="en-US">origin_alt</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_ORIGIN;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (flags.</span><span style="color: #72a1ba;" lang="en-US">relative_alt</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_HOME;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABSOLUTE;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/// get altitude in desired frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::get_alt_cm</span><span style="color: #979797;" lang="en-US">(ALT_FRAME desired_frame, </span><span style="color: #47b7a0;" lang="en-US">int32_t</span><span style="color: #979797;" lang="en-US"> &amp;ret_alt_cm) </span><span style="color: #569cd6;" lang="en-US">const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">Location_Class::ALT_FRAME frame = </span><span style="color: #989875;" lang="en-US">get_alt_frame</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// shortcut if desired and underlying frame are the same</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (desired_frame == frame) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">ret_alt_cm = alt;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// check for terrain altitude</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">float</span><span style="color: #979797;" lang="en-US"> alt_terr_cm = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (frame == ALT_FRAME_ABOVE_TERRAIN || desired_frame == ALT_FRAME_ABOVE_TERRAIN) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_TERRAIN_AVAILABLE</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_ahrs == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US"> || _terrain == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US"> || !_terrain-&gt;</span><span style="color: #989875;" lang="en-US">height_amsl</span><span style="color: #979797;" lang="en-US">(*(Location *)</span><span style="color: #569cd6;" lang="en-US">this</span><span style="color: #979797;" lang="en-US">, alt_terr_cm, </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert terrain alt to cm</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">alt_terr_cm *= </span><span style="color: #899c7f;" lang="en-US">100.0f</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#else</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert alt to absolute</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> alt_abs;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">switch</span><span style="color: #979797;" lang="en-US"> (frame) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABSOLUTE:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">alt_abs = alt;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_HOME:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">alt_abs = alt + _ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_home</span><span style="color: #979797;" lang="en-US">().</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_ORIGIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// fail if we cannot get ekf origin</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">Location ekf_origin;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_ahrs == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US"> || !_ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_origin</span><span style="color: #979797;" lang="en-US">(ekf_origin)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">alt_abs = alt + ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_TERRAIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">alt_abs = alt + alt_terr_cm;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">break</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">default</span><span style="color: #979797;" lang="en-US">:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// unknown conversion to absolute alt, this should never happen</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert absolute to desired frame</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">switch</span><span style="color: #979797;" lang="en-US"> (desired_frame) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABSOLUTE:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">ret_alt_cm = alt_abs;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_HOME:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ret_alt_cm = alt_abs - _ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_home</span><span style="color: #979797;" lang="en-US">().</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_ORIGIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// fail if we cannot get ekf origin</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">Location ekf_origin;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_ahrs == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US"> || !_ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_origin</span><span style="color: #979797;" lang="en-US">(ekf_origin)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">ret_alt_cm = alt_abs - ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">alt</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">case</span><span style="color: #979797;" lang="en-US"> ALT_FRAME_ABOVE_TERRAIN:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">ret_alt_cm = alt_abs - alt_terr_cm;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">default</span><span style="color: #979797;" lang="en-US">:</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// should never happen</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::get_vector_xy_from_origin_NEU</span><span style="color: #979797;" lang="en-US">(Vector3f &amp;vec_neu) </span><span style="color: #569cd6;" lang="en-US">const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert to neu</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">Location ekf_origin;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!_ahrs-&gt;</span><span style="color: #989875;" lang="en-US">get_origin</span><span style="color: #979797;" lang="en-US">(ekf_origin)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">vec_neu.</span><span style="color: #72a1ba;" lang="en-US">x</span><span style="color: #979797;" lang="en-US"> = (lat-ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">lat</span><span style="color: #979797;" lang="en-US">) * LATLON_TO_CM;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">vec_neu.</span><span style="color: #72a1ba;" lang="en-US">y</span><span style="color: #979797;" lang="en-US"> = (lng-ekf_origin.</span><span style="color: #72a1ba;" lang="en-US">lng</span><span style="color: #979797;" lang="en-US">) * LATLON_TO_CM * </span><span style="color: #989875;" lang="en-US">longitude_scale</span><span style="color: #979797;" lang="en-US">(ekf_origin);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::get_vector_from_origin_NEU</span><span style="color: #979797;" lang="en-US">(Vector3f &amp;vec_neu) </span><span style="color: #569cd6;" lang="en-US">const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert lat, lon</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!</span><span style="color: #989875;" lang="en-US">get_vector_xy_from_origin_NEU</span><span style="color: #979797;" lang="en-US">(vec_neu)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// convert altitude</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> alt_above_origin_cm = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!</span><span style="color: #989875;" lang="en-US">get_alt_cm</span><span style="color: #979797;" lang="en-US">(ALT_FRAME_ABOVE_ORIGIN, alt_above_origin_cm)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">vec_neu.</span><span style="color: #72a1ba;" lang="en-US">z</span><span style="color: #979797;" lang="en-US"> = alt_above_origin_cm;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return distance in meters between two locations</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">float</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::get_distance</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const struct</span><span style="color: #979797;" lang="en-US"> Location &amp;loc2) </span><span style="color: #569cd6;" lang="en-US">const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">float</span><span style="color: #979797;" lang="en-US"> dlat = (</span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US">)(loc2.</span><span style="color: #72a1ba;" lang="en-US">lat</span><span style="color: #979797;" lang="en-US"> - lat);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">float</span><span style="color: #979797;" lang="en-US"> dlng = ((</span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US">)(loc2.</span><span style="color: #72a1ba;" lang="en-US">lng</span><span style="color: #979797;" lang="en-US"> - lng)) * </span><span style="color: #989875;" lang="en-US">longitude_scale</span><span style="color: #979797;" lang="en-US">(loc2);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">norm</span><span style="color: #979797;" lang="en-US">(dlat, dlng) * LOCATION_SCALING_FACTOR;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// extrapolate latitude/longitude given distances (in meters) north and east</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">Location_Class::offset</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US"> ofs_north, </span><span style="color: #569cd6;" lang="en-US">float</span><span style="color: #979797;" lang="en-US"> ofs_east)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// use is_equal() because is_zero() is a local class conflict and is_zero() in AP_Math does not belong to a class</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!</span><span style="color: #989875;" lang="en-US">is_equal</span><span style="color: #979797;" lang="en-US">(ofs_north, </span><span style="color: #899c7f;" lang="en-US">0.0f</span><span style="color: #979797;" lang="en-US">) || !</span><span style="color: #989875;" lang="en-US">is_equal</span><span style="color: #979797;" lang="en-US">(ofs_east, </span><span style="color: #899c7f;" lang="en-US">0.0f</span><span style="color: #979797;" lang="en-US">)) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> dlat = ofs_north * LOCATION_SCALING_FACTOR_INV;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">int32_t</span><span style="color: #979797;" lang="en-US"> dlng = (ofs_east * LOCATION_SCALING_FACTOR_INV) / </span><span style="color: #989875;" lang="en-US">longitude_scale</span><span style="color: #979797;" lang="en-US">(*</span><span style="color: #569cd6;" lang="en-US">this</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">lat += dlat;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">lng += dlng;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>[/et_pb_tab][/et_pb_tabs][/et_pb_column][/et_pb_row][/et_pb_section]