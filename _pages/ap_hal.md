---
ID: 314
post_title: AP_HAL
author: impeccableaslan
post_date: 2017-06-18 10:31:33
post_excerpt: ""
layout: page
permalink: http://rcnode.com/index.php/ap_hal/
published: true
---
[et_pb_section fb_built="1" admin_label="section" _builder_version="3.0.47"][et_pb_row admin_label="row" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"][et_pb_column type="4_4" _builder_version="3.0.47" parallax="off" parallax_method="on"][et_pb_text admin_label="Text" _builder_version="3.0.47" background_size="initial" background_position="top_left" background_repeat="repeat"]
					
				[/et_pb_text][et_pb_tabs active_tab_background_color="#7cda24" _builder_version="3.0.51" tab_font="Cantata One||||" tab_text_color="#000000"][et_pb_tab title="AP_HAL.h" _builder_version="3.0.51"]<p>This is a header of all the other headers required to sustain the Hardware Abstraction Library. This is done just for convenience, not to mention the neatness resulting from this. By linking all the headers into this header, we can include all these headers simply by including this one, so #include "SUB_HAL.h".</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><stdint.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Namespace.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Boards.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Macros.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Main.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* HAL Module Classes (all pure virtual) */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"UARTDriver.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AnalogIn.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Storage.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"GPIO.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"RCInput.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"RCOutput.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Scheduler.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Semaphores.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Util.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"OpticalFlow.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_WITH_UAVCAN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"CAN.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/Print.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/Stream.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/BetterStream.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* HAL Class definition */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"HAL.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"system.h"</span></p>[/et_pb_tab][et_pb_tab title="AP_HAL_Boards.h" _builder_version="3.0.51"]<p>This is a header of all the boards turned into an enumeration lists. This <g class="gr_ gr_18 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="18" data-gr-id="18">make</g> use of the preprocessor (So read before compile time) and all of these are preprocessed (lines that <g class="gr_ gr_17 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="17" data-gr-id="17">starts</g> <g class="gr_ gr_19 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-del replaceWithoutSep" id="19" data-gr-id="19">with:</g> #define, #include, #if, #elif, #else, #error, #ifndef, <g class="gr_ gr_21 gr-alert gr_gramm gr_inline_cards gr_run_anim Style multiReplace" id="21" data-gr-id="21">#endif ;</g> These are called preprocessor directories). Preprocessing modifies data to conform with the input requirements of our library. So before <g class="gr_ gr_15 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del" id="15" data-gr-id="15">any thing</g> is started all of these are defined first, then it shall compile and thus run. Allowing for less chance for errors are an increase in efficiency in general.</p>
<p>What this specific enumeration list does is to assign each board with a few specific numbers. As such, we can make it so that the (HAL_BOARD)s with the same number equals the components it contains. So for example, if HAL_BOARD_PX4 == 5 and PX4 has a barometer then HAL_BARO_PX4 == 5. As such, HAL_BOARD_PX4 == HAL_BARO_PX4. This allows us to exclude HAL boards from the build when needed, such as if you use a PX4 board we can find the component it contains easily by equating the numbers and in the process ignore all other boards.</p>
<p>The reason some of these components don't obey this number rule is <g class="gr_ gr_105 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="105" data-gr-id="105">because</g> they have multiple versions of the hardware and instead uses a different defining number of their own. This is taken care of in the build.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* C preprocesor enumeration of the boards supported by the AP_HAL.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* This list exists so HAL_BOARD == HAL_BOARD_xxx preprocessor blocks</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* can be used to exclude HAL boards from the build when appropriate.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* It's not an elegant solution but we can improve it in future.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SITL </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SMACCM </span><span style="color: #899c7f;" lang="en-US">4 </span><span style="color: #608b4e;" lang="en-US">// unused</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_PX4 </span><span style="color: #899c7f;" lang="en-US">5</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_LINUX </span><span style="color: #899c7f;" lang="en-US">7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_VRBRAIN </span><span style="color: #899c7f;" lang="en-US">8</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_QURT </span><span style="color: #899c7f;" lang="en-US">9</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_EMPTY </span><span style="color: #899c7f;" lang="en-US">99</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Default board subtype is -1 */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_NONE </span><span style="color: #979797;" lang="en-US">-</span><span style="color: #899c7f;" lang="en-US">1</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* HAL Linux sub-types, starting at 1000 */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_NONE </span><span style="color: #899c7f;" lang="en-US">1000</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_ERLEBOARD </span><span style="color: #899c7f;" lang="en-US">1001</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_PXF </span><span style="color: #899c7f;" lang="en-US">1002</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_NAVIO </span><span style="color: #899c7f;" lang="en-US">1003</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_ZYNQ </span><span style="color: #899c7f;" lang="en-US">1004</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_BBBMINI </span><span style="color: #899c7f;" lang="en-US">1005</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_BEBOP </span><span style="color: #899c7f;" lang="en-US">1006</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_RASPILOT </span><span style="color: #899c7f;" lang="en-US">1007</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_MINLURE </span><span style="color: #899c7f;" lang="en-US">1008</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_ERLEBRAIN2 </span><span style="color: #899c7f;" lang="en-US">1009</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_BH </span><span style="color: #899c7f;" lang="en-US">1010</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_QFLIGHT </span><span style="color: #899c7f;" lang="en-US">1011</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_PXFMINI </span><span style="color: #899c7f;" lang="en-US">1012</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_NAVIO2 </span><span style="color: #899c7f;" lang="en-US">1013</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_DISCO </span><span style="color: #899c7f;" lang="en-US">1014</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_AERO </span><span style="color: #899c7f;" lang="en-US">1015</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_DARK </span><span style="color: #899c7f;" lang="en-US">1016</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_URUS </span><span style="color: #899c7f;" lang="en-US">1017</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_LINUX_BLUE </span><span style="color: #899c7f;" lang="en-US">1018</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* HAL PX4 sub-types, starting at 2000 */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_PX4_V1 </span><span style="color: #899c7f;" lang="en-US">2000</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_PX4_V2 </span><span style="color: #899c7f;" lang="en-US">2001</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_PX4_V4 </span><span style="color: #899c7f;" lang="en-US">2002</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_PX4_V3 </span><span style="color: #899c7f;" lang="en-US">2003</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_PX4_AEROFC_V1 </span><span style="color: #899c7f;" lang="en-US">2004</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* HAL VRBRAIN sub-types, starting at 4000 */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRBRAIN_V45 </span><span style="color: #899c7f;" lang="en-US">4000</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRBRAIN_V51 </span><span style="color: #899c7f;" lang="en-US">4001</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRBRAIN_V52 </span><span style="color: #899c7f;" lang="en-US">4002</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRUBRAIN_V51 </span><span style="color: #899c7f;" lang="en-US">4003</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRUBRAIN_V52 </span><span style="color: #899c7f;" lang="en-US">4004</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRCORE_V10 </span><span style="color: #899c7f;" lang="en-US">4005</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SUBTYPE_VRBRAIN_V54 </span><span style="color: #899c7f;" lang="en-US">4006</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* InertialSensor driver types */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_MPU60XX_SPI </span><span style="color: #899c7f;" lang="en-US">2</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_MPU60XX_I2C </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_HIL </span><span style="color: #899c7f;" lang="en-US">4</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_PX4 </span><span style="color: #899c7f;" lang="en-US">5</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_L3G4200D </span><span style="color: #899c7f;" lang="en-US">7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_VRBRAIN </span><span style="color: #899c7f;" lang="en-US">8</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_MPU9250_SPI </span><span style="color: #899c7f;" lang="en-US">9</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_L3GD20 </span><span style="color: #899c7f;" lang="en-US">10</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_LSM9DS0 </span><span style="color: #899c7f;" lang="en-US">11</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_RASPILOT </span><span style="color: #899c7f;" lang="en-US">12</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_MPU9250_I2C </span><span style="color: #899c7f;" lang="en-US">13</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_BH </span><span style="color: #899c7f;" lang="en-US">14</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_QFLIGHT </span><span style="color: #899c7f;" lang="en-US">15</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_QURT </span><span style="color: #899c7f;" lang="en-US">16</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_BBBMINI </span><span style="color: #899c7f;" lang="en-US">17</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_AERO </span><span style="color: #899c7f;" lang="en-US">18</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_INS_MPU6500 </span><span style="color: #899c7f;" lang="en-US">19</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Barometer driver types */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_BMP085 </span><span style="color: #899c7f;" lang="en-US">1</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_MS5611_I2C </span><span style="color: #899c7f;" lang="en-US">2</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_MS5611_SPI </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_MS5607_I2C </span><span style="color: #899c7f;" lang="en-US">4</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_PX4 </span><span style="color: #899c7f;" lang="en-US">5</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_HIL </span><span style="color: #899c7f;" lang="en-US">6</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_VRBRAIN </span><span style="color: #899c7f;" lang="en-US">7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_MS5637_I2C </span><span style="color: #899c7f;" lang="en-US">8</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_QFLIGHT </span><span style="color: #899c7f;" lang="en-US">9</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_QURT </span><span style="color: #899c7f;" lang="en-US">10</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_BMP280_I2C </span><span style="color: #899c7f;" lang="en-US">11</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_BARO_BMP280_SPI </span><span style="color: #899c7f;" lang="en-US">12</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Compass driver types */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_HMC5843 </span><span style="color: #899c7f;" lang="en-US">1</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_PX4 </span><span style="color: #899c7f;" lang="en-US">2</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_HIL </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_VRBRAIN </span><span style="color: #899c7f;" lang="en-US">4</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_AK8963_MPU9250 </span><span style="color: #899c7f;" lang="en-US">5</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_AK8963_I2C </span><span style="color: #899c7f;" lang="en-US">6</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_HMC5843_MPU6000 </span><span style="color: #899c7f;" lang="en-US">7</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_RASPILOT </span><span style="color: #899c7f;" lang="en-US">8</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_AK8963_MPU9250_I2C </span><span style="color: #899c7f;" lang="en-US">9</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_BH </span><span style="color: #899c7f;" lang="en-US">10</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_QFLIGHT </span><span style="color: #899c7f;" lang="en-US">11</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_QURT </span><span style="color: #899c7f;" lang="en-US">12</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_BBBMINI </span><span style="color: #899c7f;" lang="en-US">13</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_NAVIO2 </span><span style="color: #899c7f;" lang="en-US">14</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_NAVIO </span><span style="color: #899c7f;" lang="en-US">15</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_AERO </span><span style="color: #899c7f;" lang="en-US">16</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Heat Types */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_LINUX_HEAT_PWM </span><span style="color: #899c7f;" lang="en-US">1</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* CPU classes, used to select if CPU intensive algorithms should be used</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Note that these are only approximate, not exact CPU speeds. */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* 150Mhz: PX4 or similar. Assumes:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* - hardware floating point</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* - tens of kilobytes of memory available */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_CPU_CLASS_150 </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* GigaHz class: SITL, BeagleBone etc. Assumes megabytes of memory available. */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_CPU_CLASS_1000 </span><span style="color: #899c7f;" lang="en-US">4</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Operating system features</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* HAL implementations may define the following extra feature defines to 1 if</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* available:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* - HAL_OS_POSIX_IO : has posix-like filesystem IO</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* - HAL_OS_SOCKETS : has posix-like sockets */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* DEFINITIONS FOR BOARDS */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_SITL</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/sitl.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#elif</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_PX4</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/px4.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#elif</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_LINUX</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/linux.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#elif</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_EMPTY</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/empty.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#elif</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_QURT</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/qurt.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#elif</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_VRBRAIN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><AP_HAL/board/vrbrain.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#else</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#error</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Unknown CONFIG_HAL_BOARD type"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD_SUBTYPE</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#error</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"No CONFIG_HAL_BOARD_SUBTYPE set"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_OS_POSIX_IO</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_OS_POSIX_IO </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_OS_SOCKETS</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_OS_SOCKETS </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_PARAM_DEFAULTS_PATH</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_PARAM_DEFAULTS_PATH</span><span style="color: #569cd6;" lang="en-US"> nullptr</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_HAVE_IMU_HEATER</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_HAVE_IMU_HEATER </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_RANGEFINDER_LIGHTWARE_I2C_BUS</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_RANGEFINDER_LIGHTWARE_I2C_BUS </span><span style="color: #899c7f;" lang="en-US">1</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_HMC5843_I2C_ADDR</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_COMPASS_HMC5843_I2C_ADDR </span><span style="color: #899c7f;" lang="en-US">0x1E</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_WITH_UAVCAN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_WITH_UAVCAN </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// this is used as a general mechanism to make a 'small' build by</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// dropping little used features. We use this to allow us to keep</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// FMUv2 going for as long as possible</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_MINIMIZE_FEATURES</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_MINIMIZE_FEATURES </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p>The above are general features, meaning every board mentioned has it. However, some boards have specific features and these are defined in their own header files. This bunch of code includes these special features into this header, thus they are preprocessed as well (For the codes within defining the special features are made up of preprocessor directories as well). We don't include all the header files for all boards because it will slow down the build, instead, the board is identified and the specific header file for the board is included, nothing else.</p>
<p>"HAL_PARAM_DEFAULTS_PATH" takes the values "<g class="gr_ gr_166 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="166" data-gr-id="166">nullptr</g>" as it accepts a "path", thus normal definitions such as 0 would not cut it.</p>
<p>If the board used is undefined then an error is thrown through #error before the compiling even starts.</p>
<p>After defining the board and looking through their specific header file, should important features such as "HAL_OS_POSIX_IO" are not defined, then the code will set it to "none" or equivalent here. For others such as "HAL_RANGERFINDER_LIGHTWARE_I2C_BUS", these are absolutely necessary so would be defaulted to "Have" or equivalent. There are also those that the drone can be without such as "HAL_WITH_UAVCAN".</p>[/et_pb_tab][et_pb_tab title="AP_HAL_Macros.h" _builder_version="3.0.51"]<p>This header here is used to define some macros to help the compliers determine what complier they are, mostly because different compliers support different features. This code makes it easier to build on multiple platforms, the build will make use of these macros to find out that it can use a specific feature, or find out that it cannot use a specific feature.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">macros to allow code to build on multiple platforms more easily</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifdef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">__GNUC__</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">WARN_IF_UNUSED __attribute__</span><span style="color: #569cd6;" lang="en-US"> ((warn_unused_result))</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#else</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">WARN_IF_UNUSED</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// use this to avoid issues between C++11 with NuttX and C++10 on</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// other platforms.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #979797;" lang="en-US">!</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #c586c0;" lang="en-US">defined</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">__GXX_EXPERIMENTAL_CXX0X__</span><span style="color: #569cd6;" lang="en-US">) </span><span style="color: #979797;" lang="en-US">|| </span><span style="color: #989875;" lang="en-US">__cplusplus </span><span style="color: #979797;" lang="en-US">>= </span><span style="color: #899c7f;" lang="en-US">201103L</span><span style="color: #569cd6;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK"># define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">constexpr</span><span style="color: #569cd6;" lang="en-US"> const</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">NORETURN __attribute__</span><span style="color: #569cd6;" lang="en-US"> ((noreturn))</span></p>
<p>GNU is an operating system supporting a variety of programming languages. A GNU complier is a complier for the GNU system.</p>
<p>These #ifdef blocks are there to enable support depending on the complier used to build the code. If it's a GNU complier then it would automatically define __GNUC__. If it's defined, then the next line of this macro will detect that and put out a warning should anything related to GNUC are unused. __attribute__ make use of the function on its left, so should anything thing within the function "WARN_IF_UNUSED" are unused, a warning is generated. Else if it's not defined, then it will just run the function.</p>
<p>Const: Makes it so that the thing defined as "const" cannot be altered.</p>
<p>This is here because NuttX make use of c++ and between c++11 and c++10, the definition of "const" is different. The first line checks if the board is running c++10. C++10 does not have "const" and instead have "constexpr" whereas c++11 have both. So here we define "constexpr" as "const" and just uses "const" in our coding instead.</p>
<p>The last line is there to tell the program that this file will never truly return (think end). This is there to avoid errors involved with code path not being reached. So errors involving functions waiting for this to return will be surpassed.</p>[/et_pb_tab][et_pb_tab title="AP_HAL_Main.h" _builder_version="3.0.51"]<p>This is in essence the file of which starts the Hardware Abstraction Library.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"HAL.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_PX4 </span><span style="color: #979797;" lang="en-US">|| </span><span style="color: #989875;" lang="en-US">CONFIG_HAL_BOARD </span><span style="color: #979797;" lang="en-US">== </span><span style="color: #989875;" lang="en-US">HAL_BOARD_VRBRAIN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US"> __EXPORT ArduPilot_main</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#ifndef</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_MAIN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US"> main</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_HAL_MAIN</span><span style="color: #569cd6;" lang="en-US">() \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">AP_HAL::HAL::FunCallbacks </span><span style="color: #989875;" lang="en-US">callbacks</span><span style="color: #569cd6;" lang="en-US">(setup, loop); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">extern </span><span style="color: #cb8f76;" lang="en-US">"C"</span><span style="color: #569cd6;" lang="en-US"> { \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">int </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US">(int argc, char</span><span style="color: #979797;" lang="en-US">*</span><span style="color: #569cd6;" lang="en-US"> const argv[]); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">int </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US">(int argc, char</span><span style="color: #979797;" lang="en-US">*</span><span style="color: #569cd6;" lang="en-US"> const argv[]) { \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">hal.</span><span style="color: #989875;" lang="en-US">run</span><span style="color: #569cd6;" lang="en-US">(argc, argv, </span><span style="color: #979797;" lang="en-US">&</span><span style="color: #569cd6;" lang="en-US">callbacks); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #569cd6;" lang="en-US">; \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">} \</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_HAL_MAIN_CALLBACKS</span><span style="color: #569cd6;" lang="en-US">(</span><span style="color: #72a1ba;" lang="en-US">CALLBACKS</span><span style="color: #569cd6;" lang="en-US">) extern </span><span style="color: #cb8f76;" lang="en-US">"C"</span><span style="color: #569cd6;" lang="en-US"> { \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">int </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US">(int argc, char</span><span style="color: #979797;" lang="en-US">*</span><span style="color: #569cd6;" lang="en-US"> const argv[]); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">int </span><span style="color: #989875;" lang="en-US">AP_MAIN</span><span style="color: #569cd6;" lang="en-US">(int argc, char</span><span style="color: #979797;" lang="en-US">*</span><span style="color: #569cd6;" lang="en-US"> const argv[]) { \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">hal.</span><span style="color: #989875;" lang="en-US">run</span><span style="color: #569cd6;" lang="en-US">(argc, argv, CALLBACKS); \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #569cd6;" lang="en-US">; \</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">} \</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">}</p>[/et_pb_tab][et_pb_tab title="AP_HAL_Namespace.h" _builder_version="3.0.51"]<p>A namespace is <g class="gr_ gr_20 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-del replaceWithoutSep" id="20" data-gr-id="20">like </g>a region in which similar things gets grouped together. It is also there to avoid name collisions, for a namespace has to be declared before accessing the function/stuff within the namespace. This is the HAL specific namespace in which the class names for drivers and other such things are stored. A class provide blueprints for the object, so the class "I2CDevice" would provide information related to I2C devices. Of course, these information has to be defined and this is done elsewhere.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"string.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/functor.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">namespace</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Toplevel pure virtual class Hal.*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">HAL</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Toplevel class names for drivers: */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">UARTDriver</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">I2CDevice</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">I2CDeviceManager</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Device</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">SPIDevice</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">SPIDeviceDriver</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">SPIDeviceManager</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AnalogSource</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AnalogIn</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Storage</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">DigitalSource</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">GPIO</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">RCInput</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">RCOutput</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Scheduler</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Semaphore</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">OpticalFlow</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">CANManager</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">CAN</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Util</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Utility Classes */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Print</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">Stream</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">BetterStream</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* Typedefs for function pointers (Procedure, Member Procedure)</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">For member functions we use the FastDelegate delegates class</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">which allows us to encapculate a member function as a type</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">typedef</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">(*Proc)(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">FUNCTOR_TYPEDEF</span><span style="color: #979797;" lang="en-US">(MemberProc, </span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Global names for all of the existing SPI devices on all platforms.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> SPIDeviceType {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// Devices using AP_HAL::SPIDevice abstraction</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">SPIDevice_Type = -</span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// Must be implemented by the concrete HALs.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">const</span><span style="color: #979797;" lang="en-US"> HAL& </span><span style="color: #989875;" lang="en-US">get_HAL</span><span style="color: #979797;" lang="en-US">();</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p>A "typedef" works in a similar fashion to #define in the sense that it give a type a definition by replacing the previous definition with a new definition provided.</p>
<p>Function pointers are pointers that <g class="gr_ gr_99 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="99" data-gr-id="99">points</g> to a function. The syntax for function pointers are as follows: void (*function) (type) It returns "void" as it merely executes the function with given type. "Proc" is short for <g class="gr_ gr_100 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="100" data-gr-id="100">procedure</g>, that is a routine that carries out some tasks. A procedure's definition begins with "void". The line "typedef void(*Proc)(void);" makes it so that the whole function pointer is a type. That is this pointed to <g class="gr_ gr_102 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="102" data-gr-id="102">procedure</g> of which has the type void(as in has a definition starting with void), of which returns a void has become a type on its own.</p>
<p>Functors are function objects, function objects are objects made from types such as struct or class that can act as a function. The line "FUNCTOR_TYPEDEF (MemberProc, void);" make use of an existing function named FUNCTOR_TYPEDEF and initialize it with………</p>
<p>Here, the enum SPIDeviceType houses the value of the device using SPI……</p>
<p>Get_HAL() does….</p>[/et_pb_tab][et_pb_tab title="Analogin.h" _builder_version="3.0.51"]<p><g class="gr_ gr_4 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="4" data-gr-id="4">Analogin</g> is used to read an external voltage applied to an analog input pin. An analog input pin is a form of input as shown:</p>
<p><img src="http://rcnode.com/wp-content/uploads/2017/06/analogin-300x243.png" width="300" height="243" alt="" class="wp-image-318 alignnone size-medium" /></p>
<p>Where the block rectangles with even blacker squares are <g class="gr_ gr_34 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="34" data-gr-id="34">analog</g> input pin. They are called "Analog" as <g class="gr_ gr_36 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar only-ins doubleReplace replaceWithoutSep" id="36" data-gr-id="36">voltage</g> is used to supply a continuous signal to those pins, and analog has the definition of something using signals or information represented by a <g class="gr_ gr_37 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="37" data-gr-id="37">continuous</g> variable physical quantity such as voltage.</p>
<p>The reading is done by the pin itself, an <g class="gr_ gr_85 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="85" data-gr-id="85">analogin</g> merely access the readings of the pin and stores/prints/uses it for you. Therefore, only some pins are capable of doing this.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><inttypes.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Namespace.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US">::AnalogSource {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">read_average</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">read_latest</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_pin</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> p) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// optionally allow setting of a pin that stops the device from</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// reading. This is needed for sonar devices where you have more</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// than one sonar, and you want to stop them interfering with each</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// other. It assumes that if held low the device is stopped, if</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// held high the device starts reading.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_stop_pin</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> p) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// optionally allow a settle period in milliseconds. This is only</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// used if a stop pin is set. If the settle period is non-zero</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// then the analog input code will wait to get a reading for that</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// number of milliseconds. Note that this will slow down the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// reading of analog inputs.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_settle_time</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint16_t</span><span style="color: #979797;" lang="en-US"> settle_time_ms) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return a voltage from 0.0 to 5.0V, scaled</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// against a reference voltage</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">voltage_average</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return a voltage from 0.0 to 5.0V, scaled</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// against a reference voltage</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">voltage_latest</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return a voltage from 0.0 to 5.0V, assuming a ratiometric</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// sensor</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">voltage_average_ratiometric</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US">::AnalogIn {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">init</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> AP_HAL::AnalogSource* </span><span style="color: #989875;" lang="en-US">channel</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">int16_t</span><span style="color: #979797;" lang="en-US"> n) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// board 5V rail voltage in volts</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">board_voltage</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// servo rail voltage in volts, or 0 if unknown</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">float </span><span style="color: #989875;" lang="en-US">servorail_voltage</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) { </span><span style="color: #c586c0;" lang="en-US">return </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// power supply status flags, see MAV_POWER_STATUS</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">uint16_t </span><span style="color: #989875;" lang="en-US">power_status_flags</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) { </span><span style="color: #c586c0;" lang="en-US">return </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">ANALOG_INPUT_BOARD_VCC </span><span style="color: #899c7f;" lang="en-US">254</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#define</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">ANALOG_INPUT_NONE </span><span style="color: #899c7f;" lang="en-US">255</span></p>
<p>Here, we are actually using the pins after reading their data. This is done through some functions implemented in another header. Setting it to 0 means that it is turned off in default but can be turned on should you decide to use it. This is done due to the fact that 0 represents low and 1 represents high (This is taught earlier). All of these are encased within a specific element of the class AP_HAL, of which is defined in another header file and takes the name of AnalogSource. This whole thing supply functions to perform certain analogin tasks such as reading the average voltage or the latest.</p>
<p>The set_pin function allows setting a pin that stops the device from reading, especially useful for devices where it contains more than one sonar and there is need to stop them from interfering with each other. Here, 0 is not high or low but just on or off. By turning it on, the function will automatically read the voltage of the pin and if it's held high the device will start reading and if it's held low the device will be stopped. It is defaulted turned off.</p>
<p>The set_stop_pin function allows the user to set a period of time in milliseconds before the analog input code gets a reading. So this will slow down the reading of analog inputs. The period of time is set in "set_settle_time(unit16_t settle_time_ms)" of which is another function provided. Note how it's void so it merely sets the value and does not return anything. The "voltage_average()" and similar functions actually return the values read by "read_average()". The voltage returned is in the range 0 to 5 v for it is usually between the two as explained earlier.</p>
<p>The whole Analogsource class is then pointed to by channel in the class: "AnalogIn" with its default set to zero. This is done because it would be tedious to implement the Analogsource class within the class AnalogIn. It is far clearly to implement Analogsource first then be referred in AnalogIn. Other functions included within this class are "servorail_voltage" that returns the voltage specified by the board or 0 if unknown. "Power_status_flags" return the power status of the board or 0 if unknown. It is good practice to always return a value whether the value intended to be found is found or not. The defines are there for the purpose in "SUB_HAL_BOARDS.h".</p>
<p>The "voltage_average()" and similar functions actually return the values read by "read_average()". The voltage returned is in the range 0 to 5 v for it is usually between the two as explained earlier. The whole Analogsource class is then pointed to by channel in the class: "AnalogIn" with its default set to zero. This is done because it would be tedious to implement the Analogsource class within the class AnalogIn. It is far clearly to implement Analogsource first then be referred in AnalogIn. Other functions included within this class are "servorail_voltage" that returns the voltage specified by the board or 0 if unknown. "Power_status_flags" return the power status of the board or 0 if unknown. It is good practice to always return a value whether the value intended to be found is found or not.</p>
<p>The defines are there for the purpose in "AP_HAL_BOARDS.h".</p>[/et_pb_tab][et_pb_tab title="CAN.h" _builder_version="3.0.51"]<p>A CAN port is used as input and output of a CAN interface. A CAN interface, CAN as in Controller Area Network is a bus standard designed to allow microcontrollers and devices to communicate <g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="6" data-gr-id="6">in</g> applications without a host computer. It is a message based protocol. The CAN port is what allows this to happen.</p>
<p>One of these protocols is what known as a UAVCAN, of which is a lightweight protocol designed for reliable communication in aerospace and robotic applications via CAN bus. Should this code detect that the board used has UAVCAN, (#if HAL_WITH_UAVCAN) where the function is defined elsewhere, the codes below it will run. What the codes below are the definition of UAVCAN, because it would be of no use if a board without UAVCAN runs the below code. Not only is it taxing but a waste of time, literally.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><inttypes.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><string.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><assert.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><cmath></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">HAL_WITH_UAVCAN</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Namespace.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/functor.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><uavcan/driver/can.hpp></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><uavcan/time.hpp></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_UAVCAN</span><span style="color: #569cd6;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Single non-blocking CAN interface.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US">::CAN: public uavcan::ICanIface {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* CAN port open method</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">bitrate Selects the speed that the port will be configured to. If zero, the port speed is left unchanged.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return false - CAN port open failed</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">true - CAN port open succeeded</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">begin</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> bitrate) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">CAN port close</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">end</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Reset opened CAN port</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Pending messages to be transmitted are deleted and receive state and FIFO also reset.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">All pending errors are cleared.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">reset</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Test if CAN port is opened and initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return false - CAN port not initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">true - CAN port is initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">is_initialized</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Return if CAN port has some untransmitted pending messages</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return -1 - CAN port is not opened or initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">0 - no messages are pending</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">positive - number of pending messages</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">int32_t </span><span style="color: #989875;" lang="en-US">tx_pending</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Return if CAN port has received but yet read messages</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return -1 - CAN port is not opened or initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">0 - no messages are pending for read</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">positive - number of pending messages for read</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">int32_t </span><span style="color: #989875;" lang="en-US">available</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Generic CAN driver.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US">::CANManager: public uavcan::ICanDriver {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* CAN port open method</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Opens port with specified bit rate</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">bitrate - selects the speed that the port will be configured to. If zero, the port speed is left</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">unchanged.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">can_number - the index of can interface to be opened</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return false - CAN port open failed</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">true - CAN port open succeeded</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">begin</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> bitrate, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> can_number) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Test if CAN manager is ready and initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">return false - CAN manager not initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">true - CAN manager is initialized</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">is_initialized</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> AP_UAVCAN *</span><span style="color: #989875;" lang="en-US">get_UAVCAN</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_UAVCAN</span><span style="color: #979797;" lang="en-US">(AP_UAVCAN *uavcan);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p>Here, the class AP_UAVCAN is declared. It might seem complicated but is merely a mixture of <g class="gr_ gr_20 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="20" data-gr-id="20">deriving</g> and inheritance. The CAN <g class="gr_ gr_23 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="23" data-gr-id="23">derived</g> from AP_HAL inherited ICanIFace derived from <g class="gr_ gr_21 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="21" data-gr-id="21">uavcan</g>. The "Public" placed before <g class="gr_ gr_22 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="22" data-gr-id="22">uavcan</g> signifies that the public members of ICanIFace become public members of CAN and protected members of ICanIFace become protected members of CAN.</p>
<p>Bitrate: The number of bits per second that can be transmitted <g class="gr_ gr_26 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="26" data-gr-id="26">along</g> a digital network.</p>
<p>The "virtual" at the start of the lines signifies that these are inherited from ICanIface with its own twist. This is because what "virtual" does is when used on lines in the base class (Here ICanIFace), "virtual" makes it so that when the base class is inherited, these specific functions written after "virtual" are able to be altered by the derived class (Here CAN). The general format and basis <g class="gr_ gr_37 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="37" data-gr-id="37">is</g> the same, that is they can't change the workings of the function etc but they can change what is inputted etc. For example, if the default bitrate given by "virtual bool begin(uint32_t bitrate) in ICanIface is A, then we can change A to B in CAN.</p>
<p>The function "virtual bool begin(uint32_t bitrate) = 0;" returns a Boolean, that is the value of either true or false. Here, bitrate selects the speed that the CAN port will be configured to. If the function is initialized by zero, the port speed will take its default value. If some other numbers <g class="gr_ gr_49 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="49" data-gr-id="49">is</g> assigned, then the port will take the speed of that value.</p>
<p>"virtual void end() = 0;" closes the port, so communication is ceased.</p>
<p>"virtual void reset() = 0;" This resets a CAN port that is currently opened. Pending messages to be transmitted are deleted and all states are reset. Any errors that are pending should also be cleared.</p>
<p>"virtual bool is_initialized() = 0;" this tests if the CAN port is opened and initialized, either with 0 or some other values. It will return false if the CAN port is not opened and/or initialized and true if it's opened and initialized.</p>
<p>"virtual int32_t tx_pending() = 0;" this function will return two values, either -1 or 0. -1 means the CAN port has some untransmitted pending messages. That is, the CAN port is not opened or initialized. 0 if there are no pending messages (All sent).</p>
<p>"virtual int32_t available() = 0;" returns -1 if the CAN port has received messages but have yet to read then. That is, the CAN port is not opened or initialized. Return 0 if there are no messages pending to be read.</p>
<p>Here, another inheritance from the same base class is made and is used to <g class="gr_ gr_80 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling" id="80" data-gr-id="80">manager</g> the CAN bus. The function " virtual bool begin(uint32_t bitrate, uint8_t can_number) = 0;" has the operation of opening CAN ports embedded within it. However, it returns true or false. Like above, you can select a bitrate and 0 means no change. Can_number refers to the index of can interface to be opened and the function will return false if the CAN port opening process failed, return true if the CAN port opening succeeded.</p>
<p>"virtual bool is_initialized() = 0;" test if the CAN manager is up and ready. If it's initialized it will return true and vice versa for false.</p>
<p>"virtual AP_UAVCAN *get_UAVCAN(void);" this declared function make use of the pointer towards the function, get_UAVCAN, and initialize it by "void".</p>
<p>"virtual void set_UAVCAN(AP_UAVCAN *<g class="gr_ gr_96 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="96" data-gr-id="96">uavcan</g>);" this is another function pointer and allows you to access the function to <g class="gr_ gr_97 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="97" data-gr-id="97">configue</g> the <g class="gr_ gr_98 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling ins-del multiReplace" id="98" data-gr-id="98">uavcan</g>.</p>[/et_pb_tab][et_pb_tab title="DEVICE.h" _builder_version="3.0.51"]<p>This is the abstraction library for devices, especially the methods of connection such as I2C and SPI devices. From here on, try exploring the codes yourself, there will still be information on unfamiliar codes and functions but for the most <g class="gr_ gr_6 gr-alert gr_gramm gr_inline_cards gr_run_anim Punctuation only-ins replaceWithoutSep" id="6" data-gr-id="6">part</g> it's pretty <g class="gr_ gr_8 gr-alert gr_spell gr_inline_cards gr_run_anim ContextualSpelling multiReplace" id="8" data-gr-id="8">self explanatory</g>.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#pragma</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #72a1ba;" lang="en-US">once</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><inttypes.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"AP_HAL_Namespace.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"utility/functor.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* This is an interface abstracting I2C and SPI devices</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">class</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">AP_HAL</span><span style="color: #979797;" lang="en-US">::Device {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">public:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> BusType {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">BUS_TYPE_UNKNOWN = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">BUS_TYPE_I2C = </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">BUS_TYPE_SPI = </span><span style="color: #899c7f;" lang="en-US">2</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">BUS_TYPE_UAVCAN = </span><span style="color: #899c7f;" lang="en-US">3</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> Speed {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">SPEED_HIGH,</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">SPEED_LOW,</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">FUNCTOR_TYPEDEF</span><span style="color: #979797;" lang="en-US">(PeriodicCb, </span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">typedef</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">* PeriodicHandle;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">Device</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">enum</span><span style="color: #979797;" lang="en-US"> BusType type)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus_type</span><span style="color: #979797;" lang="en-US"> = type;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return bus type</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> BusType </span><span style="color: #989875;" lang="en-US">bus_type</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> _bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus_type</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return bus number</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">bus_num</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> _bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return 24 bit bus identifier</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint32_t</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_bus_id</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> _bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// return address on bus</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_bus_address</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">) </span><span style="color: #569cd6;" lang="en-US">const</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> _bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">address</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// set device type within a device class (eg. AP_COMPASS_TYPE_LSM303D)</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_device_type</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> devtype) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">devtype</span><span style="color: #979797;" lang="en-US"> = devtype;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;" lang="en-US"> </p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">~Device</span><span style="color: #979797;" lang="en-US">() {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US"> != </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">delete[]</span><span style="color: #979797;" lang="en-US"> _checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Set the speed of future transfers. Depending on the bus the speed may</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* be shared for all devices on the same bus.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true if speed was successfully set or platform doesn't implement</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* it; false otherwise.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">set_speed</span><span style="color: #979797;" lang="en-US">(Speed speed) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Core transfer function. This does a single bus transaction which</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* sends send_len bytes and receives recv_len bytes back from the slave.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true on a successful transfer, false on failure.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">transfer</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">const </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> *send, </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> send_len,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> *recv, </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> recv_len) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Wrapper function over #transfer() to read recv_len registers, starting</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* by first_reg, into the array pointed by recv. The read flag passed to</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* #set_read_flag(uint8_t) is ORed with first_reg before performing the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* transfer.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true on a successful transfer, false on failure.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">read_registers</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> first_reg, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> *recv, </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> recv_len)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">first_reg |= _read_flag;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">transfer</span><span style="color: #979797;" lang="en-US">(&first_reg, </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">, recv, recv_len);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Wrapper function over #transfer() to write a byte to the register reg.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* The transfer is done by sending reg and val in that order.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true on a successful transfer, false on failure.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">write_register</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> reg, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> val, </span><span style="color: #569cd6;" lang="en-US">bool</span><span style="color: #979797;" lang="en-US"> checked=</span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> buf[</span><span style="color: #899c7f;" lang="en-US">2</span><span style="color: #979797;" lang="en-US">] = { reg, val };</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (checked) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">set_checked_register</span><span style="color: #979797;" lang="en-US">(reg, val);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">transfer</span><span style="color: #979797;" lang="en-US">(buf, </span><span style="color: #569cd6;" lang="en-US">sizeof</span><span style="color: #979797;" lang="en-US">(buf), </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">, </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* set a value for a checked register</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_checked_register</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> reg, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> val);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* setup for register value checking. Frequency is how often to check registers. If set to 10 then</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* every 10th call to check_next_register will check a register</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">setup_checked_registers</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> num_regs, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> frequency=</span><span style="color: #899c7f;" lang="en-US">10</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* check next register value for correctness. Return false if value is incorrect</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* or register checking has not been setup</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">check_next_register</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Wrapper function over #transfer() to read a sequence of bytes from</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* device. No value is written, differently from the #read_registers()</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* method and hence doesn't include the read flag set by #set_read_flag()</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">read</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> *recv, </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> recv_len)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">transfer</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">, </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">, recv, recv_len);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Get the semaphore for the bus this device is in. This is intended for</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* drivers to use during initialization phase only.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> AP_HAL::Semaphore *</span><span style="color: #989875;" lang="en-US">get_semaphore</span><span style="color: #979797;" lang="en-US">() = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Register a periodic callback for this bus. All callbacks on the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* same bus are made from the same thread with lock already taken. In</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* other words, the callback is not executed on the main thread (or the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* thread which registered the callback), but in a separate per-bus</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* thread.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* After registering the periodic callback, the other functions should not</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* be used anymore from other contexts. If it really needs to be done, the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* lock must be taken.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: A handle for this periodic callback. To cancel the callback</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* call #unregister_callback() or return false on the callback.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> PeriodicHandle </span><span style="color: #989875;" lang="en-US">register_periodic_callback</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> period_usec, PeriodicCb) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Adjust the time for the periodic callback registered with</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* #register_periodic_callback. Note that the time will be re-calculated</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* from the moment this call is made and expire after @period_usec.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true if periodic callback was successfully adjusted, false otherwise.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">adjust_periodic_callback</span><span style="color: #979797;" lang="en-US">(PeriodicHandle h, </span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> period_usec) = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Cancel a periodic callback on this bus.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Return: true if callback was successfully unregistered, false</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* otherwise.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">unregister_callback</span><span style="color: #979797;" lang="en-US">(PeriodicHandle h) { </span><span style="color: #c586c0;" lang="en-US">return </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* support for direct control of SPI chip select. Needed for</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* devices with unusual SPI transfer patterns that include</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* specific delays</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">bool </span><span style="color: #989875;" lang="en-US">set_chip_select</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">bool</span><span style="color: #979797;" lang="en-US"> set) { </span><span style="color: #c586c0;" lang="en-US">return </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">; }</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* Some devices connected on the I2C or SPI bus require a bit to be set on</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* the register address in order to perform a read operation. This sets a</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* flag to be used by #read_registers(). The flag's default value is zero.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_read_flag</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> flag)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">_read_flag = flag;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Calibri; font-size: 11.0pt;" lang="en-US"> </p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* make a bus id given bus type, bus number, bus address and</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* device type This is for use by devices that do not use one of</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* the standard HAL Device types, such as UAVCAN devices</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">uint32_t </span><span style="color: #989875;" lang="en-US">make_bus_id</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">enum</span><span style="color: #979797;" lang="en-US"> BusType bus_type, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> bus, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> address, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> devtype) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> DeviceId d;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus_type</span><span style="color: #979797;" lang="en-US"> = bus_type;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus</span><span style="color: #979797;" lang="en-US"> = bus;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">address</span><span style="color: #979797;" lang="en-US"> = address;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">devtype</span><span style="color: #979797;" lang="en-US"> = devtype;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> d.</span><span style="color: #72a1ba;" lang="en-US">devid</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* return a new bus ID for the same bus connection but a new device type.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* This is used for auxillary bus connections</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">static</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">uint32_t </span><span style="color: #989875;" lang="en-US">change_bus_id</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint32_t</span><span style="color: #979797;" lang="en-US"> old_id, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> devtype) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> DeviceId d;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid</span><span style="color: #979797;" lang="en-US"> = old_id;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">d.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">devtype</span><span style="color: #979797;" lang="en-US"> = devtype;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> d.</span><span style="color: #72a1ba;" lang="en-US">devid</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/**</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">* return bus ID with a new devtype</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint32_t</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">get_bus_id_devtype</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> devtype) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">change_bus_id</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #989875;" lang="en-US">get_bus_id</span><span style="color: #979797;" lang="en-US">(), devtype);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/* set number of retries on transfers */</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">virtual</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">void </span><span style="color: #989875;" lang="en-US">set_retries</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> retries) {};</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">protected:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> _read_flag = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">broken out device elements. The bitfields are used to keep</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">the overall value small enough to fit in a float accurately,</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">which makes it possible to transport over the MAVLink</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">parameter protocol without loss of information.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">DeviceStructure</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">enum</span><span style="color: #979797;" lang="en-US"> BusType bus_type : </span><span style="color: #899c7f;" lang="en-US">3</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> bus: </span><span style="color: #899c7f;" lang="en-US">5</span><span style="color: #979797;" lang="en-US">; </span><span style="color: #608b4e;" lang="en-US">// which instance of the bus type</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> address; </span><span style="color: #608b4e;" lang="en-US">// address on the bus (eg. I2C address)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> devtype; </span><span style="color: #608b4e;" lang="en-US">// device class specific device type</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> DeviceId {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">DeviceStructure</span><span style="color: #979797;" lang="en-US"> devid_s;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint32_t</span><span style="color: #979797;" lang="en-US"> devid;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">union</span><span style="color: #979797;" lang="en-US"> DeviceId _bus_id;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// set device address (eg. i2c bus address or spi CS)</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_device_address</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> address) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">address</span><span style="color: #979797;" lang="en-US"> = address;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// set device bus number</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">set_device_bus</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> bus) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_bus_id.</span><span style="color: #72a1ba;" lang="en-US">devid_s</span><span style="color: #979797;" lang="en-US">.</span><span style="color: #72a1ba;" lang="en-US">bus</span><span style="color: #979797;" lang="en-US"> = bus;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #569cd6;">private:</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// checked registers</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">checkreg</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> regnum;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> value;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> n_allocated;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> n_set;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> next;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> frequency;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> counter;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">checkreg</span><span style="color: #979797;" lang="en-US"> *regs;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">} _checked;</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">};</p>[/et_pb_tab][et_pb_tab title="DEVICE.cpp" _builder_version="3.0.51"]<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US">"Device.h"</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#include</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #cb8f76;" lang="en-US"><stdio.h></span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">using checked registers allows a device check that a set of critical</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">register values don't change at runtime. This is useful on key</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">sensors (such as IMUs) which may experience brownouts or other</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">issues in flight</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">To use register checking call setup_checked_registers() once to</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">allocate the space for the checked register values. The set the</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">checked flag on any write_register() calls that you <g class="gr_ gr_13 gr-alert gr_gramm gr_inline_cards gr_run_anim Grammar multiReplace" id="13" data-gr-id="13">want protected</g>.</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">Periodically (say at 50Hz) you should then call</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">check_next_register(). If that returns false then the sensor has had</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">a corrupted register value. Marking the sensor as unhealthy is</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">approriate. The bad value will be corrected</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">setup nregs checked registers</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_HAL::Device::setup_checked_registers</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> nregs, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> frequency)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US"> != </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">delete[]</span><span style="color: #979797;" lang="en-US"> _checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">n_allocated</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">next</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #c586c0;" lang="en-US">new </span><span style="color: #569cd6;" lang="en-US">struct </span><span style="color: #47b7a0;" lang="en-US">checkreg</span><span style="color: #979797;" lang="en-US">[nregs];</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US"> == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">n_allocated</span><span style="color: #979797;" lang="en-US"> = nregs;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">frequency</span><span style="color: #979797;" lang="en-US"> = frequency;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">counter</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">set value of one checked register</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">void</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_HAL::Device::set_checked_register</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> reg, </span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> val)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US"> == </span><span style="color: #569cd6;" lang="en-US">nullptr</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">checkreg</span><span style="color: #979797;" lang="en-US"> *regs = _checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">for</span><span style="color: #979797;" lang="en-US"> (</span><span style="color: #47b7a0;" lang="en-US">uint8_t</span><span style="color: #979797;" lang="en-US"> i=</span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">; i<_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US">; i++) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (regs[i].</span><span style="color: #72a1ba;" lang="en-US">regnum</span><span style="color: #979797;" lang="en-US"> == reg) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">regs[i].</span><span style="color: #72a1ba;" lang="en-US">value</span><span style="color: #979797;" lang="en-US"> = val;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US"> == _checked.</span><span style="color: #72a1ba;" lang="en-US">n_allocated</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">printf</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #cb8f76;" lang="en-US">"Not enough checked registers for reg 0x%02x on device 0x%x\n"</span><span style="color: #979797;" lang="en-US">,</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">(</span><span style="color: #569cd6;" lang="en-US">unsigned</span><span style="color: #979797;" lang="en-US">)reg, (</span><span style="color: #569cd6;" lang="en-US">unsigned</span><span style="color: #979797;" lang="en-US">)</span><span style="color: #989875;" lang="en-US">get_bus_id</span><span style="color: #979797;" lang="en-US">());</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">regs[_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US">].</span><span style="color: #72a1ba;" lang="en-US">regnum</span><span style="color: #979797;" lang="en-US"> = reg;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">regs[_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US">].</span><span style="color: #72a1ba;" lang="en-US">value</span><span style="color: #979797;" lang="en-US"> = val;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US">++;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">/*</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">check one register value</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">*/</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">bool</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #989875;" lang="en-US">AP_HAL::Device::check_next_register</span><span style="color: #979797;" lang="en-US">(</span><span style="color: #569cd6;" lang="en-US">void</span><span style="color: #979797;" lang="en-US">)</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">{</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (_checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US"> == </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (++_checked.</span><span style="color: #72a1ba;" lang="en-US">counter</span><span style="color: #979797;" lang="en-US"> < _checked.</span><span style="color: #72a1ba;" lang="en-US">frequency</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">counter</span><span style="color: #979797;" lang="en-US"> = </span><span style="color: #899c7f;" lang="en-US">0</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #569cd6;" lang="en-HK">struct</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #47b7a0;" lang="en-US">checkreg</span><span style="color: #979797;" lang="en-US"> &reg = _checked.</span><span style="color: #72a1ba;" lang="en-US">regs</span><span style="color: #979797;" lang="en-US">[_checked.</span><span style="color: #72a1ba;" lang="en-US">next</span><span style="color: #979797;" lang="en-US">];</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #47b7a0;" lang="en-HK">uint8_t</span><span style="color: #979797;" lang="en-US"> v;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">if</span><span style="color: #979797;" lang="en-US"> (!</span><span style="color: #989875;" lang="en-US">read_registers</span><span style="color: #979797;" lang="en-US">(reg.</span><span style="color: #72a1ba;" lang="en-US">regnum</span><span style="color: #979797;" lang="en-US">, &v, </span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">) || v != reg.</span><span style="color: #72a1ba;" lang="en-US">value</span><span style="color: #979797;" lang="en-US">) {</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// a register has changed value unexpectedly. Try changing it back</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">// and re-check it next time</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">#if</span><span style="color: #569cd6;" lang="en-US"> </span><span style="color: #899c7f;" lang="en-US">0</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">printf("Device 0x%x fixing 0x%02x 0x%02x -> 0x%02x\n",</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">(unsigned)get_bus_id(),</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #608b4e;">(unsigned)reg.regnum, (unsigned)v, (unsigned)reg.value);</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #c586c0;">#endif</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #989875;" lang="en-HK">write_register</span><span style="color: #979797;" lang="en-US">(reg.</span><span style="color: #72a1ba;" lang="en-US">regnum</span><span style="color: #979797;" lang="en-US">, reg.</span><span style="color: #72a1ba;" lang="en-US">value</span><span style="color: #979797;" lang="en-US">);</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">false</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #979797;" lang="en-HK">_checked.</span><span style="color: #72a1ba;" lang="en-US">next</span><span style="color: #979797;" lang="en-US"> = (_checked.</span><span style="color: #72a1ba;" lang="en-US">next</span><span style="color: #979797;" lang="en-US">+</span><span style="color: #899c7f;" lang="en-US">1</span><span style="color: #979797;" lang="en-US">) % _checked.</span><span style="color: #72a1ba;" lang="en-US">n_set</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt;"><span style="color: #c586c0;" lang="en-HK">return</span><span style="color: #979797;" lang="en-US"> </span><span style="color: #569cd6;" lang="en-US">true</span><span style="color: #979797;" lang="en-US">;</span></p>
<p style="margin: 0in; font-family: Menlo; font-size: 9.0pt; color: #979797;">}</p>[/et_pb_tab][et_pb_tab title="Boards" _builder_version="3.0.51"][/et_pb_tab][/et_pb_tabs][/et_pb_column][/et_pb_row][/et_pb_section]